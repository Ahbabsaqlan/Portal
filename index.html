
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIUB Student Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #003366;
            --secondary: #e67e22;
            --accent: #3498db;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --lecture: #4e73df;
            --lab: #1cc88a;
            --primary-light: #e0eaf3; /* Added for program course hover */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, #002244 100%);
            color: white;
            padding: 0.75rem 2rem; /* Adjusted padding for a sleeker look */
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: #fff;
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo span {
            color: var(--secondary);
            margin-left: 5px;
        }

        .university-name {
            font-size: 1.4rem; /* Adjusted font size */
            font-weight: bold;
        }

        .nav-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 10px; /* Reduced gap */
        }

        .nav-menu li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px; /* Adjusted padding */
            border-radius: var(--border-radius);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-menu li a:hover,
        .nav-menu li a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .user-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-icon, .user-profile {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }
        .user-profile a { /* To make the user profile icon linkable */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            text-decoration: none;
        }


        .notification-icon:hover, .user-profile:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        .user-profile.active-parent { /* Style for active profile icon */
             background-color: rgba(255, 255, 255, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--secondary);
            color: white;
            font-size: 0.7rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Notification Dropdown */
        .notification-dropdown {
            position: absolute;
            top: 50px; /* Position below the icon */
            right: 0;
            width: 350px; /* Slightly wider */
            background-color: white;
            color: var(--dark);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1001;
            display: none; /* Hidden by default */
            overflow: hidden;
            border: 1px solid #ddd;
        }

        .notification-dropdown.show {
            display: block;
        }

        .notification-header {
            padding: 0.75rem 1rem;
            font-size: 1.1rem;
            font-weight: 600; /* Bolder */
            color: var(--primary);
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
        }

        .notification-header .mark-all-read {
            font-size: 0.8rem;
            color: var(--accent);
            cursor: pointer;
            font-weight: 500;
        }
        .notification-header .mark-all-read:hover {
            text-decoration: underline;
        }


        .notification-list {
            max-height: 320px; /* Increased height */
            overflow-y: auto;
        }
        /* Scrollbar styling for notification list */
        .notification-list::-webkit-scrollbar {
            width: 6px;
        }
        .notification-list::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .notification-list::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        .notification-list::-webkit-scrollbar-thumb:hover {
            background: #bbb;
        }


        .notification-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #eee;
            display: flex;
            gap: 12px; /* Increased gap */
            align-items: flex-start;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        .notification-item:hover {
            background-color: #e9ecef; /* Lighter hover */
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item .icon-wrapper { /* Wrapper for icon */
            flex-shrink: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 3px;
        }
        .notification-item .icon-wrapper i { font-size: 0.9rem; color: white; }

        .notification-item .icon-wrapper.info { background-color: var(--accent); }
        .notification-item .icon-wrapper.success { background-color: var(--success); }
        .notification-item .icon-wrapper.warning { background-color: var(--warning); }
        .notification-item .icon-wrapper.danger { background-color: var(--danger); }


        .notification-content .title {
            font-weight: 600;
            margin-bottom: 0.1rem;
            font-size: 0.95rem;
        }
        .notification-content .message {
            font-size: 0.85rem;
            color: #555;
            line-height: 1.4;
            margin-bottom: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .notification-content .time {
            font-size: 0.75rem;
            color: #888;
        }

        .notification-footer {
            padding: 0.75rem;
            text-align: center;
            border-top: 1px solid #eee;
            background-color: #f8f9fa;
        }
        .notification-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .notification-footer a:hover {
            text-decoration: underline;
        }


        /* Page Container */
        .page-container {
            flex: 1;
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: flex;
            gap: 25px;
            width: 100%;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 250px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem 0;
            height: fit-content;
            flex-shrink: 0;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li a {
            display: flex;
            align-items: center;
            padding: 0.9rem 1.5rem;
            text-decoration: none;
            color: var(--dark);
            gap: 12px;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .sidebar-menu li a:hover,
        .sidebar-menu li a.active {
            background-color: rgba(0, 51, 102, 0.05);
            color: var(--primary);
            border-left: 3px solid var(--primary);
        }

        .sidebar-menu li a i {
            width: 24px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            min-width: 0; /* Prevent flex item from overflowing */
        }

        /* Welcome Section */
        .welcome-section {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .welcome-text h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }

        .welcome-text p {
            opacity: 0.9;
            max-width: 600px;
        }

        .quick-stats {
            display: flex;
            gap: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 1rem;
            border-radius: var(--border-radius);
        }

        .stat-card {
            text-align: center;
            padding: 0.5rem 1rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .stat-card .label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden; 
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            font-size: 1.2rem;
        }

        .card-header .icon {
            font-size: 1.2rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Enhanced Schedule Styles */
        .schedule-container { 
        }
        .schedule-day {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        .schedule-day:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }


        .day-header {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.5rem 0;
            border-bottom: 2px solid #f0f2f5;
        }

        .day-header.current-day {
            background-color: rgba(230, 126, 34, 0.1);
            border-radius: 6px;
            padding: 0.5rem 1rem;
            color: var(--secondary);
            border-bottom: 2px solid var(--secondary);
        }

        .schedule-item {
            display: flex;
            justify-content: space-between;
            align-items: center; 
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: var(--border-radius);
            background: #f9fafb;
            transition: var(--transition);
            border-left: 4px solid var(--lecture);
            cursor: pointer;
        }

        .schedule-item.lab {
            border-left: 4px solid var(--lab);
        }

        .schedule-item:hover {
            background-color: #edf2f7;
            transform: translateX(3px);
        }

        .schedule-item.current-class {
            background-color: #e6f7ff;
            border-left: 4px solid var(--accent);
            position: relative;
        }

        .schedule-item.current-class::after {
            content: "NOW";
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--accent);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .course-info {
            flex: 1;
        }

        .course-code {
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 0.25rem;
        }

        .course-time {
            color: #666;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .course-room {
            background-color: #e8f4fd;
            color: var(--accent);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            min-width: 70px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            flex-shrink: 0; 
        }

        /* Announcements */
        .announcement-item {
            padding: 1rem 0; 
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }
        .card-body .announcement-item:first-child { 
            padding-top: 0;
        }
         .card-body .announcement-item:last-child { 
            border-bottom: none;
            padding-bottom: 0;
        }

        .announcement-item:hover {
            background-color: #f8f9fa; 
        }

        .announcement-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .announcement-date {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .announcement-content {
            font-size: 0.95rem;
        }


        .btn {
            display: inline-flex; 
            padding: 0.6rem 1.5rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            text-decoration: none;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem; 
        }
        .btn.btn-sm { 
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            gap: 5px;
        }


        .btn:hover:not(:disabled) { 
            background-color: #002244;
            transform: translateY(-2px);
        }
        .btn:disabled, .btn.disabled {
            background-color: #a0a0a0 !important; 
            border-color: #a0a0a0 !important;
            color: #ccc !important;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #d35400;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover:not(:disabled) {
            background-color: #bd2130;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover:not(:disabled) {
            background-color: var(--primary);
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 10px; 
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .status-badge.status-item { 
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee; 
        }
         .status-badge.status-item:last-child {
            border-bottom: none; 
        }
        .status-badge.status-item span:first-child {
            color: var(--dark);
            flex-grow: 1; 
        }


        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background-color: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Page Content */
        .page-content {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #f0f2f5;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            margin-top: 1.5rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.8rem 1rem; 
            text-align: left;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem; 
        }

        th {
            background-color: #f8f9fa;
            color: var(--primary);
            font-weight: 600;
        }

        tr:hover {
            background-color: #f1f5f9; 
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem; 
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 0.95rem; 
            transition: var(--transition);
        }
        .form-control[readonly] {
            background-color: #e9ecef;
            opacity: 1;
        }


        .form-control:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 1.5rem;
        }
        .form-row:last-child { 
            margin-bottom: 0;
        }


        .form-col {
            flex: 1;
        }

        /* Result Card */
        .result-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
        }

        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .result-title {
            font-size: 1.2rem;
            color: var(--primary);
        }

        .result-semester {
            font-weight: bold;
            color: var(--secondary);
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-item {
            display: flex;
            flex-direction: column;
        }

        .result-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .result-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* Financial Card */
        .financial-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
        }

        .financial-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .financial-breakdown { 
            margin-top: 1.5rem;
        }
        .financial-breakdown h4 {
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }


        .financial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .financial-title {
            font-size: 1.2rem;
            color: var(--primary);
        }

        .financial-status {
            font-weight: bold;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
        }

        .paid {
            background-color: #d4edda;
            color: #155724;
        }

        .pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .financial-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 1rem;
        }

        .financial-item {
            display: flex;
            flex-direction: column;
        }

        .financial-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .financial-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .financial-actions {
            display: flex;
            gap: 15px;
            margin-top: 1.5rem;
        }

        /* Footer Styles */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 2rem;
            margin-top: 3rem;
        }

        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--secondary);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.5rem;
        }

        .footer-links a {
            color: #ddd;
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-links a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid #444;
            color: #aaa;
        }

        /* Page Navigation */
        .page-navigation {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background-color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex; 
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .page-navigation i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        /* Semester Selector */
        .semester-selector {
            margin-bottom: 1.5rem;
            max-width: 300px;
        }

        .semester-select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            background-color: white;
        }

        /* Assessment Breakdown */
        .assessment-breakdown {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            display: none;
        }
        .assessment-breakdown h4 { 
            color: var(--primary);
            margin-bottom: 1rem;
        }


        .assessment-breakdown.active {
            display: block;
        }

        /* Financial Summary */
        .financial-summary {
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
        }
        .financial-summary h3 { 
            color: var(--primary);
            margin-bottom: 1rem;
        }


        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #eee;
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* Change Request Form */
        .change-form {
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 1.5rem;
            display: none;
        }
        .change-form h3 { 
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .change-form.active {
            display: block;
        }

        /* Full-width card */
        .full-width {
            grid-column: 1 / -1;
        }

        /* Credit Summary */
        .credit-summary {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .credit-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 1.5rem;
            border-right: 1px solid #ddd;
        }

        .credit-item:last-child {
            border-right: none;
        }

        .credit-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .credit-label {
            font-size: 0.9rem;
            color: #666;
        }

        /* Course Details Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            overflow-y: auto;
            padding-top: 2rem; 
            padding-bottom: 2rem;
        }

        .modal-content {
            background-color: white;
            margin: 0 auto; 
            max-width: 800px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: modalOpen 0.3s ease;
        }

        @keyframes modalOpen {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background-color: var(--primary);
            color: white;
            padding: 1.5rem;
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .close-modal:hover {
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 1.5rem;
        }
        .modal-body h4 { 
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }


        .modal-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 1.5rem;
            flex-wrap: wrap; 
        }

        .modal-tab {
            padding: 0.8rem 1.2rem; 
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-size: 0.85rem; 
            display: flex; 
            align-items: center;
            gap: 6px;
        }

        .modal-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .modal-tab:hover:not(.active) {
            background-color: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .faculty-info { 
            display: flex;
            gap: 20px;
            margin-bottom: 1.5rem;
        }

        .faculty-avatar { 
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #f0f2f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--primary);
            flex-shrink: 0;
        }
        .faculty-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }


        .faculty-details { 
            flex: 1;
        }
        .faculty-details h4 { margin-bottom: 0.5rem; color: var(--dark);}
        .faculty-details p { font-size: 0.9rem; margin-bottom: 0.3rem; color: #555;}


        .consulting-schedule { 
            margin-top: 1.5rem;
        }

        .consulting-item { 
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
        }

        .note-item, .assignment-item { 
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        .note-item:last-child, .assignment-item:last-child {
            border-bottom: none;
        }
        .note-title, .assignment-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            color: var(--dark);
        }
        .note-meta, .assignment-due-date {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .assignment-status {
            font-size: 0.85rem;
            font-weight: bold;
            margin-top: 0.3rem;
            display: inline-block;
        }
        .assignment-status.submitted { color: var(--success); }
        .assignment-status.pending { color: var(--warning); }
        .assignment-status.overdue { color: var(--danger); }

        .upload-area {
            margin-top: 1rem;
            padding: 1rem;
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            text-align: center;
            background-color: #fdfdfd;
        }
        .upload-area p { font-size: 0.9rem; color: #777; margin-bottom: 0.5rem;}
        .upload-area input[type="file"] {
            margin-bottom: 0.5rem;
            display: block; 
            margin-left: auto;
            margin-right: auto;
            max-width: 300px;
        }


        .notice-item { 
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        .notice-item:last-child {
            border-bottom: none;
        }
        .notice-title { 
            font-weight: bold;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .notice-date { 
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        /* Curriculum Section */
        #curriculum .page-title { 
            border-bottom-color: var(--secondary);
        }
        .curriculum-semester {
            margin-bottom: 2.5rem; 
            padding: 1.5rem;
            background-color: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-left: 5px solid var(--secondary);
        }
        .curriculum-semester:last-child {
            margin-bottom: 0;
        }
        .curriculum-semester h3 {
            color: var(--primary); 
            font-size: 1.6rem; 
            margin-bottom: 1.5rem; 
            display: flex;
            align-items: center;
            gap: 12px; 
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #f0f2f5;
        }
        .curriculum-courses {
            list-style: none;
            padding-left: 0;
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }
        .curriculum-courses li {
            background-color: #f8f9fa;
            padding: 1rem 1.25rem; 
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column; 
            justify-content: space-between;
            align-items: flex-start; 
            transition: var(--transition);
            font-size: 0.95rem;
            border: 1px solid #e9ecef;
        }
        .curriculum-courses li:hover {
            background-color: #eef3f8;
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
        }
        .curriculum-courses .course-code-title {
            font-weight: 600; 
            color: var(--primary);
            font-size: 1rem;
            margin-bottom: 0.5rem; 
        }
        .curriculum-courses .course-code-title i {
            margin-right: 8px;
            color: var(--secondary);
        }
        .curriculum-courses .course-credits {
            color: #fff; 
            font-size: 0.85rem;
            background-color: var(--accent); 
            padding: 4px 10px; 
            border-radius: 15px; 
            align-self: flex-end; 
            margin-top: 0.5rem;
        }

        /* Exam Schedule Section */
        .exam-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .exam-tab {
            padding: 0.8rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-size: 1rem; 
        }
        .exam-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }
        .exam-tab:hover:not(.active) {
            background-color: #f8f9fa;
        }
        .exam-content {
            display: none;
        }
        .exam-content.active {
            display: block;
        }
        .exam-content h3 { 
            font-size: 1.3rem;
            color: var(--secondary);
            margin-bottom: 1rem;
        }
        .exam-item {
            background-color: var(--light);
            padding: 1rem 1.5rem; 
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .exam-item h4 {
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .exam-item p {
            font-size: 0.95rem;
            margin-bottom: 0.35rem; 
            color: #555;
            display: flex;
            align-items: center;
        }
        .exam-item p i {
            margin-right: 8px;
            color: var(--secondary);
            width: 16px; 
            text-align: center;
        }


        /* Registration Schedule Section */
         #selected-courses-for-registration-container .registration-course-card {
            border-left-color: var(--accent); /* Different border for selected pending items */
            background-color: #f0f8ff; /* AliceBlue or similar light blue */
        }
        #selected-courses-for-registration-container .registration-course-card h4 {
            font-size: 1.05rem;
        }
        #selected-courses-for-registration-container .registration-course-card p {
            font-size: 0.85rem;
            margin-bottom: 0.3rem;
        }
        #selected-courses-for-registration-container .registration-course-card .btn {
            align-self: flex-end; /* Push remove button to the right for selected cards */
        }


        .search-container { 
            margin-bottom: 1.5rem;
            display: flex;
            gap: 10px;
            align-items: center; 
        }
        #program-course-search-input, #section-search-input { 
            padding: 0.8rem 1rem; 
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            flex-grow: 1; 
            font-size: 1rem;
        }
        #program-course-search-input:focus, #section-search-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        #final-confirm-registration-btn { 
            flex-shrink: 0; 
            padding-left: 1rem;
            padding-right: 1rem;
        }


        .program-course-list-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 1.5rem; 
            margin-bottom: 2rem;
        }
        .program-course-item {
            background-color: #fff; 
            padding: 1.25rem; 
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid #e0e0e0; 
            text-align: left; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
        }
        .program-course-item:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,51,102,0.1);
        }
        .program-course-item h5 {
            margin-bottom: 0.5rem; 
            color: var(--primary);
            font-size: 1.1rem; 
            font-weight: 600;
            display: flex;
            align-items: center;
        }
         .program-course-item h5 i {
            margin-right: 8px;
            color: var(--secondary);
        }
        .program-course-item p {
            font-size: 0.9rem; 
            color: #555;
            background-color: var(--primary-light);
            padding: 3px 8px;
            border-radius: 12px;
            display: inline-block; 
        }


        #offered-sections-container h3 { 
            font-size: 1.4rem;
            color: var(--secondary);
            margin-bottom: 1rem;
        }
        .back-to-courses-btn {
            margin-bottom: 1.5rem;
        }


        .registration-course-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 20px;
        }
        .registration-course-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            transition: var(--transition);
            border-left: 4px solid var(--primary);
            display: flex; 
            flex-direction: column;
        }
        .registration-course-card.conflict { 
            border-left-color: var(--danger);
            background-color: #fff2f2;
        }
        .registration-course-card.conflict .btn {
            background-color: var(--danger) !important;
        }

        .registration-course-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        .registration-course-card h4 {
            font-size: 1.15rem; 
            color: var(--primary);
            margin-bottom: 0.75rem;
        }
        .registration-course-card p {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px; 
        }
        .registration-course-card p i {
            color: var(--secondary);
            width: 16px;
            text-align: center;
        }
        .registration-course-card .enrollment-status {
            font-weight: bold;
            color: var(--accent);
        }
        .registration-course-card .btn {
            margin-top: auto; 
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            align-self: flex-start; 
        }
        .no-results {
            grid-column: 1 / -1; 
            text-align: center;
            padding: 2rem;
            font-size: 1.1rem;
            color: #777;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }

        /* Application Page Styles */
        .application-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        .application-card {
            background-color: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: var(--transition);
            border-top: 4px solid var(--primary);
            text-decoration: none; 
            color: inherit; 
        }
        .application-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.12);
        }
        .application-card .app-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: rgba(0, 51, 102, 0.1);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .application-card h3 {
            font-size: 1.2rem;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }
        .application-card p {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
            flex-grow: 1; 
        }
        .application-card .btn {
            margin-top: auto; 
        }

        /* Drop Course Application Page Styles */
        #drop-course-application-page .registered-course-item-to-drop {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            border: 1px solid #eee;
        }
        #drop-course-application-page .registered-course-item-to-drop .course-details {
            font-size: 1rem;
        }
        #drop-course-application-page .registered-course-item-to-drop .course-details strong {
            color: var(--primary);
        }

        /* Academic Calendar Styles */
        #academic-calendar-page {
            --calendar-bg: white;
            --calendar-border: #ddd;
            --calendar-header-bg: var(--primary);
            --calendar-header-text: white;
            --calendar-day-text: #555;
            --calendar-day-hover-bg: #f0f0f0;
            --calendar-today-bg: #fff9e6; 
            --calendar-today-border: var(--secondary);
            --calendar-event-bg: var(--accent);
            --calendar-event-text: white;
        }
        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .calendar-controls button {
            background: var(--primary);
            border: none;
            color: white;
            padding: 0.6rem 1.2rem; 
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        .calendar-controls button:hover {
            background-color: #002244; 
        }
        #month-year-display {
            font-size: 1.6rem; 
            font-weight: bold;
            color: var(--primary);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px; 
            background-color: var(--calendar-border);
            border: 1px solid var(--calendar-border);
            border-radius: var(--border-radius);
            overflow: hidden; 
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
        .calendar-header-cell, .calendar-day-cell {
            padding: 0.75rem 0.5rem;
            text-align: center;
            background-color: var(--calendar-bg);
        }
        .calendar-header-cell {
            background-color: var(--calendar-header-bg);
            color: var(--calendar-header-text);
            font-weight: bold;
            font-size: 0.9rem;
            padding: 0.8rem 0.5rem; 
        }
        .calendar-day-cell {
            min-height: 120px; 
            position: relative;
            cursor: default;
            font-size: 0.9rem;
            color: var(--calendar-day-text);
            display: flex;
            flex-direction: column; 
            align-items: flex-start; 
            padding: 0.5rem; 
        }
        .calendar-day-cell:hover:not(.empty-day) {
            background-color: var(--calendar-day-hover-bg);
        }
        .calendar-day-cell.empty-day {
            background-color: #f9f9f9; 
            cursor: default;
        }
        .calendar-day-cell .day-number {
            font-weight: bold;
            margin-bottom: 0.35rem; 
            align-self: flex-end; 
            padding: 2px 4px;
            font-size: 0.85rem;
        }
        .calendar-day-cell.today {
            background-color: var(--calendar-today-bg);
        }
        .calendar-day-cell.today .day-number {
            background-color: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .calendar-event {
            font-size: 0.78rem; 
            padding: 3px 6px; 
            background-color: var(--calendar-event-bg);
            color: var(--calendar-event-text);
            border-radius: 4px;
            margin-top: 4px; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: calc(100% - 4px); 
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .calendar-event:hover {
            opacity: 0.85;
        }
        .calendar-event i {
            font-size: 0.7rem; 
        }
        .calendar-event.holiday { background-color: var(--success); }
        .calendar-event.exam { background-color: var(--danger); }
        .calendar-event.deadline { background-color: var(--warning); color: var(--dark); }
        .calendar-event.registration { background-color: var(--accent); }
        .calendar-event.other { background-color: #6c757d; } 


        .event-tooltip { 
            display: none;
            position: absolute;
            background-color: var(--dark);
            color: white;
            padding: 8px;
            border-radius: var(--border-radius);
            z-index: 10;
            font-size: 0.8rem;
            box-shadow: var(--shadow);
            bottom: 105%; 
            left: 50%;
            transform: translateX(-50%);
            white-space: normal;
            width: max-content;
            max-width: 200px;
        }
        .calendar-event:hover .event-tooltip {
            display: block;
        }
        /* Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark);
            color: white;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.5s ease, bottom 0.5s ease;
            font-size: 0.9rem;
        }
        .toast-notification.show {
            opacity: 1;
            bottom: 30px;
        }
        .toast-notification.success { background-color: var(--success); }
        .toast-notification.error { background-color: var(--danger); }
        .toast-notification.warning { background-color: var(--warning); color: var(--dark); }



        /* Responsive Design */
        @media (max-width: 992px) {
            .page-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                margin-bottom: 1.5rem; 
            }
            
            .welcome-section {
                flex-direction: column;
                text-align: center;
                gap: 1.5rem;
            }
            
            .quick-stats {
                width: 100%;
                justify-content: center;
            }
            
            .modal-content {
                width: 90%;
                margin: 2rem auto; 
            }
            .header-container {
                padding: 0.75rem 1rem; 
            }
            .university-name {
                font-size: 1.2rem; 
            }
             .calendar-day-cell { min-height: 80px; font-size: 0.8rem;}
            .calendar-event { font-size: 0.7rem; }
            #month-year-display { font-size: 1.2rem; }
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem; 
            }
            .logo-container {
                margin-bottom: 0.5rem; 
            }
            .nav-container {
                width: 100%;
                justify-content: space-between; 
            }
            .nav-menu { 
                display: flex;
                gap: 5px;
                justify-content: center;
                width: auto;
                margin-bottom: 0.5rem;
            }
            .nav-menu li a {
                padding: 6px 10px;
                font-size: 0.9rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .action-buttons .btn {
                width: 100%;
            }
            
            .quick-stats {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0; 
            }
            .form-row .form-col:not(:last-child) .form-group { 
                 margin-bottom: 1.5rem;
            }

            
            .faculty-info {
                flex-direction: column;
                align-items: center; 
                text-align: center;
            }
            .modal-tabs {
                justify-content: flex-start; 
            }
            .modal-tab {
                flex-grow: 1; 
                text-align: center;
            }
            .registration-course-list {
                grid-template-columns: 1fr; 
            }
             .curriculum-courses {
                grid-template-columns: 1fr; 
            }
             .calendar-day-cell { min-height: 60px; padding: 0.5rem 0.25rem; }
            .calendar-event { display: none; } 
            .calendar-day-cell.today .day-number::after { content: '•'; color: var(--calendar-event-bg); margin-left: 2px; } 
            .calendar-header-cell { font-size: 0.8rem; padding: 0.5rem 0.2rem;}
            .calendar-controls { flex-direction: column; gap: 0.5rem; }
            .search-container { flex-wrap: wrap; }
            #final-confirm-registration-btn { width: 100%; margin-top: 0.5rem; } 
        }

        @media (max-width: 576px) {
            body {
                font-size: 14px; 
            }
            .header-container {
                padding: 0.75rem;
            }
            .logo { width: 40px; height: 40px; font-size: 20px;}
            .university-name { font-size: 1rem; }
            .user-controls { gap: 10px; }
            .notification-icon, .user-profile { width: 35px; height: 35px;}
            .notification-dropdown { width: calc(100vw - 40px); right: -10px; }


            .page-container { padding: 0 1rem; margin-top: 1rem; }
            .page-content { padding: 1rem; }
            .page-title { font-size: 1.5rem; margin-bottom: 1rem; }

            .welcome-text h1 { font-size: 1.6rem; }
            .quick-stats { flex-direction: column; gap: 5px; }
            .stat-card { padding: 0.25rem 0.5rem; }
            .stat-card .value { font-size: 1.2rem; }
            
            .credit-summary {
                flex-direction: column;
                gap: 10px;
            }
            
            .credit-item {
                border-right: none;
                border-bottom: 1px solid #ddd;
                padding: 0.75rem; 
                width: 100%;
            }
            .credit-item:last-child {
                border-bottom: none;
            }
            
            .modal-title {
                font-size: 1.2rem;
            }
            .modal-tab {
                padding: 0.6rem 0.8rem; 
                font-size: 0.8rem;
            }
            .financial-details, .result-details {
                grid-template-columns: 1fr; 
            }
            th, td { padding: 0.6rem; font-size: 0.85rem; }
            .btn { padding: 0.5rem 1rem; font-size: 0.85rem; }
            .search-container { flex-direction: column; }
            #final-confirm-registration-btn { width: auto; margin-top: 0; } 
            .application-cards-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="header-container">
            <div class="logo-container">
                <a href="index.html" class="logo">AIUB<span>Portal</span></a>
                <!-- <div class="university-name">American International University-Bangladesh</div> -->
            </div>
            <div class="nav-container">
                <ul class="nav-menu">
                    <li><a href="#dashboard" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="#registered-courses"><i class="fas fa-book"></i> Courses</a></li>
                    <li><a href="#academic-results"><i class="fas fa-chart-line"></i> Results</a></li>
                    <li><a href="#financial-statements"><i class="fas fa-file-invoice-dollar"></i> Finance</a></li>
                </ul>
                <div class="user-controls">
                    <div class="notification-icon">
                        <i class="fas fa-bell"></i>
                        <div class="notification-badge">3</div>
                        <div class="notification-dropdown">
                            <div class="notification-header">
                                Notifications
                                <span class="mark-all-read">Mark all as read</span>
                            </div>
                            <div class="notification-list">
                                <div class="notification-item">
                                    <div class="icon-wrapper info"><i class="fas fa-file-alt"></i></div>
                                    <div class="notification-content">
                                        <div class="title">New Grade Posted</div>
                                        <div class="message">Your grade for CSE3205 - Software Engineering has been published. Check your results now!</div>
                                        <div class="time">15 mins ago</div>
                                    </div>
                                </div>
                                <div class="notification-item">
                                    <div class="icon-wrapper success"><i class="fas fa-bullhorn"></i></div>
                                    <div class="notification-content">
                                        <div class="title">Upcoming Event: CS Fest</div>
                                        <div class="message">AIUB CS Fest starts tomorrow! Don't miss out on exciting competitions and workshops.</div>
                                        <div class="time">2 hours ago</div>
                                    </div>
                                </div>
                                <div class="notification-item">
                                    <div class="icon-wrapper danger"><i class="fas fa-exclamation-triangle"></i></div>
                                    <div class="notification-content">
                                        <div class="title">Fee Payment Due Soon</div>
                                        <div class="message">Your tuition fee payment for the current semester is due in 3 days. Please pay on time.</div>
                                        <div class="time">1 day ago</div>
                                    </div>
                                </div>
                                 <div class="notification-item">
                                    <div class="icon-wrapper warning"><i class="fas fa-calendar-check"></i></div>
                                    <div class="notification-content">
                                        <div class="title">Class Rescheduled</div>
                                        <div class="message">MAT3109 class on Wednesday has been rescheduled from 10 AM to 2 PM due to a faculty meeting.</div>
                                        <div class="time">3 days ago</div>
                                    </div>
                                </div>
                            </div>
                            <div class="notification-footer">
                                <a href="#">View All Notifications</a>
                            </div>
                        </div>
                    </div>
                    <div class="user-profile">
                        <a href="#profile" aria-label="User Profile"><i class="fas fa-user"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Page Navigation (Floating Action Button style) -->
    <div class="page-navigation">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Main Content Container -->
    <div class="page-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <ul class="sidebar-menu">
                <li><a href="#dashboard" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="#class-schedule-page"><i class="fas fa-calendar-alt"></i> Class Schedule</a></li>
                <li><a href="#registered-courses"><i class="fas fa-book"></i> Registered Courses</a></li>
                <li><a href="#academic-results"><i class="fas fa-chart-line"></i> Academic Results</a></li>
                <li><a href="#financial-statements"><i class="fas fa-file-invoice-dollar"></i> Financial Statement</a></li>
                <li><a href="#profile"><i class="fas fa-user-graduate"></i> Student Profile</a></li>
                <li><a href="#applications-page"><i class="fas fa-clipboard-list"></i> Applications</a></li>
                <li><a href="#curriculum"><i class="fas fa-book-open"></i> Curriculum</a></li>
                <li><a href="#exam-schedule"><i class="fas fa-calendar-check"></i> Exam Schedule</a></li>
                <li><a href="#academic-calendar-page"><i class="fas fa-calendar-week"></i> Academic Calendar</a></li>
                <li><a href="#registration-schedule"><i class="fas fa-edit"></i> Registration</a></li>
                <li><a href="#"><i class="fas fa-question-circle"></i> Help & Support</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Page -->
            <section id="dashboard">
                <!-- Welcome Section (Original) -->
                <section class="welcome-section">
                    <div class="welcome-text">
                        <h1>Welcome back, Sarah Ahmed!</h1>
                        <p>Bachelor of Science in Computer Science & Engineering | ID: 22-48108-2 | <span id="dashboard-current-semester-display">Spring 2023-2024</span></p>
                    </div>
                    <div class="quick-stats" id="dashboard-quick-stats">
                        <div class="stat-card"><div class="value" data-stat="cgpa">3.89</div><div class="label">CGPA</div></div>
                        <div class="stat-card"><div class="value" data-stat="attendance">125</div><div class="label">Credits Completed</div></div>
                        <div class="stat-card"><div class="value" data-stat="credits">15</div><div class="label">Credits Current</div></div>
                        <div class="stat-card"><div class="value" data-stat="due">0</div><div class="label">Due Fees</div></div>
                    </div>
                </section>

                <!-- Dashboard Grid (Original Structure with schedule items made clickable) -->
                <div class="dashboard-grid">
                    <!-- Enhanced Weekly Schedule - Full Width (Original) -->
                    <div class="card full-width">
                        <div class="card-header">
                            <h2><i class="fas fa-calendar-week"></i> Weekly Schedule</h2>
                            <div class="icon"><i class="fas fa-clock"></i></div>
                        </div>
                        <div class="card-body schedule-container" id="dashboard-schedule-content">
                            <!-- Schedule content will be injected here by JS for current semester -->
                        </div>
                    </div>

                    <!-- Recent Announcements (Original) -->
                    <div class="card">
                        <div class="card-header"><h2><i class="fas fa-bullhorn"></i> Recent Announcements</h2><div class="icon"><i class="fas fa-exclamation-circle"></i></div></div>
                        <div class="card-body">
                            <div class="announcement-item"><div class="announcement-title"><i class="fas fa-file-alt"></i> Midterm Exam Schedule</div><div class="announcement-date"><i class="fas fa-calendar"></i> March 15, 2024</div><div class="announcement-content">The midterm examination schedule for Spring 2023-2024 has been published...</div></div>
                            <div class="announcement-item"><div class="announcement-title"><i class="fas fa-graduation-cap"></i> Scholarship Application</div><div class="announcement-date"><i class="fas fa-calendar"></i> March 12, 2024</div><div class="announcement-content">Merit-based scholarship applications are now open...</div></div>
                            <div class="announcement-item"><div class="announcement-title"><i class="fas fa-briefcase"></i> Career Development Workshop</div><div class="announcement-date"><i class="fas fa-calendar"></i> March 10, 2024</div><div class="announcement-content">Join our career development workshop on March 25th...</div></div>
                        </div>
                    </div>

                    <!-- Quick Actions (Links will be handled by JS navigation) -->
                    <div class="card">
                        <div class="card-header"><h2><i class="fas fa-bolt"></i> Quick Actions</h2><div class="icon"><i class="fas fa-rocket"></i></div></div>
                        <div class="card-body"><div class="action-buttons">
                                <a href="#registration-schedule" class="btn data-nav-link"><i class="fas fa-edit"></i> Course Registration</a>
                                <a href="#academic-results" class="btn data-nav-link"><i class="fas fa-chart-bar"></i> View Results</a>
                                <a href="#financial-statements" class="btn data-nav-link"><i class="fas fa-credit-card"></i> Fee Payment</a>
                                <a href="#applications-page" class="btn data-nav-link"><i class="fas fa-file-certificate"></i> Applications</a>
                                <a href="#profile" class="btn btn-secondary data-nav-link"><i class="fas fa-user-edit"></i> Update Profile</a>
                                <a href="#academic-calendar-page" class="btn data-nav-link"><i class="fas fa-calendar-alt"></i> Academic Calendar</a>
                        </div></div>
                    </div>

                    <!-- Upcoming Deadlines (Original) -->
                    <div class="card">
                        <div class="card-header"><h2><i class="fas fa-exclamation-triangle"></i> Upcoming Deadlines</h2><div class="icon"><i class="fas fa-clock"></i></div></div>
                        <div class="card-body">
                            <div class="schedule-item" style="cursor:default; border-left-color: var(--danger);"><div><div class="course-code" style="color: var(--dark-emphasis);">Midterm Exams</div><div class="course-time">March 25 - April 5, 2024</div></div><div style="color: var(--danger); font-weight: bold;">7 days left</div></div>
                            <div class="schedule-item" style="cursor:default; border-left-color: var(--warning);"><div><div class="course-code" style="color: var(--dark-emphasis);">Project Submission</div><div class="course-time">CSE 3205 - April 10, 2024</div></div><div style="color: var(--warning); font-weight: bold;">22 days left</div></div>
                            <div class="schedule-item" style="cursor:default; border-left-color: var(--success);"><div><div class="course-code" style="color: var(--dark-emphasis);">Tuition Fee Payment</div><div class="course-time">Spring 2023-2024</div></div><div style="color: var(--success); font-weight: bold;">Paid</div></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Class Schedule Page (New) -->
            <section id="class-schedule-page" class="page-content" style="display: none;">
                <h2 class="page-title"><i class="fas fa-calendar-alt"></i> Class Schedule</h2>
                <div class="semester-selector">
                    <select class="semester-select" id="class-schedule-semester">
                        <option value="spring2024">Spring 2023-2024</option>
                        <option value="fall2023">Fall 2022-2023</option>
                        <option value="summer2023">Summer 2022-2023</option>
                    </select>
                </div>
                <div class="card full-width" style="margin-top: 1.5rem; box-shadow: none; border: 1px solid #eee;">
                    <div class="card-header" style="border-radius: var(--border-radius) var(--border-radius) 0 0;">
                        <h2 id="class-schedule-semester-title"><i class="fas fa-calendar-week"></i> Weekly Schedule - Spring 2023-2024</h2>
                    </div>
                    <div class="card-body schedule-container" id="class-schedule-content-area">
                        <!-- Schedule will be dynamically loaded here -->
                        <p class="no-results" style="display:none;">No schedule available for the selected semester.</p>
                    </div>
                </div>
            </section>


            <!-- Registered Courses Page (Original Structure - Will be made dynamic) -->
            <section id="registered-courses" class="page-content" style="display: none;">
                <h2 class="page-title"><i class="fas fa-book"></i> Registered Courses</h2>
                <div class="semester-selector">
                    <select class="semester-select" id="registered-courses-semester-filter">
                        <option value="spring2024">Spring 2023-2024</option>
                        <option value="fall2023">Fall 2022-2023</option>
                        <option value="summer2023">Summer 2022-2023</option>
                    </select>
                </div>
                <div class="credit-summary" id="registered-courses-credit-summary">
                    <!-- Credit summary will be updated by JS -->
                </div>
                <div class="table-container" id="registered-courses-table-container">
                     <!-- Table will be generated by JS -->
                     <p class="no-results" style="text-align:center; padding:1rem;">No courses registered for this semester.</p>
                </div>
            </section>

            <!-- Academic Results Page (Will be made dynamic) -->
            <section id="academic-results" class="page-content" style="display: none;">
                <h2 class="page-title"><i class="fas fa-chart-line"></i> Academic Results</h2>
                <div class="semester-selector">
                    <select class="semester-select" id="results-semester-filter">
                        <option value="spring2024">Spring 2023-2024</option>
                        <option value="fall2023">Fall 2022-2023</option>
                        <option value="summer2023">Summer 2022-2023</option>
                    </select>
                </div>
                <div id="academic-results-content-area">
                    <!-- Dynamic content will be injected here -->
                     <p class="no-results">No results available for the selected semester.</p>
                </div>
            </section>


            <!-- Financial Statements Page (Original Structure) -->
            <section id="financial-statements" class="page-content" style="display: none;">
                <h2 class="page-title"><i class="fas fa-file-invoice-dollar"></i> Financial Statements</h2>
                <div class="semester-selector"><select class="semester-select" id="finance-semester-filter">
                    <option value="spring2024">Spring 2023-2024</option>
                    <option value="fall2023">Fall 2022-2023</option>
                    </select>
                </div>
                <div id="financial-statements-content-area">
                     <div class="semester-content" id="spring2024-finance"> <div class="financial-card"><div class="financial-header"><div class="financial-title">Spring 2023-2024</div><div class="financial-status paid">Paid</div></div><div class="financial-details">
                        <div class="financial-item"><span class="financial-label">Total Amount</span><span class="financial-value">৳ 125,000</span></div><div class="financial-item"><span class="financial-label">Amount Paid</span><span class="financial-value">৳ 125,000</span></div>
                        <div class="financial-item"><span class="financial-label">Due Date</span><span class="financial-value">February 15, 2024</span></div><div class="financial-item"><span class="financial-label">Payment Date</span><span class="financial-value">February 10, 2024</span></div>
                    </div><div class="financial-actions"><button class="btn"><i class="fas fa-print"></i> Print Invoice</button><button class="btn"><i class="fas fa-download"></i> Download Receipt</button><button class="btn" id="view-payment-history"><i class="fas fa-history"></i> Payment History</button></div>
                    <div class="financial-breakdown"><h4>Fee Breakdown</h4><div class="table-container"><table><thead><tr><th>Fee Type</th><th>Amount (৳)</th></tr></thead><tbody>
                        <tr><td>Tuition Fee (15 credits)</td><td>75,000</td></tr><tr><td>Registration Fee</td><td>10,000</td></tr><tr><td>Lab Fee</td><td>15,000</td></tr>
                        <tr><td>Library Fee</td><td>5,000</td></tr><tr><td>Student Activity Fee</td><td>2,000</td></tr><tr><td>Technology Fee</td><td>3,000</td></tr>
                        <tr><td>Health Service Fee</td><td>1,500</td></tr><tr><td>Development Fee</td><td>13,500</td></tr><tr style="font-weight: bold;"><td>Total</td><td>125,000</td></tr>
                    </tbody></table></div></div></div>
                    <div class="financial-summary"><h3>Total University Spending</h3>
                        <div class="summary-item"><span>Tuition Fees:</span><span>৳ 420,000</span></div><div class="summary-item"><span>Registration Fees:</span><span>৳ 40,000</span></div>
                        <div class="summary-item"><span>Lab Fees:</span><span>৳ 60,000</span></div><div class="summary-item"><span>Library Fees:</span><span>৳ 20,000</span></div>
                        <div class="summary-item"><span>Other Fees:</span><span>৳ 45,000</span></div><div class="summary-item"><span>Total:</span><span>৳ 585,000</span></div>
                    </div>
                    <div class="page-content" id="payment-history" style="display: none; margin-top: 2rem; padding:0; box-shadow: none; border: 1px solid #eee; border-radius: var(--border-radius);">
                        <h3 class="page-title" style="padding: 1rem; margin-bottom:0; border-bottom: 1px solid #eee; background-color: #f8f9fa; border-top-left-radius: var(--border-radius); border-top-right-radius: var(--border-radius); "><i class="fas fa-history"></i> Payment History</h3>
                        <div class="table-container" style="margin-top:0;"><table><thead><tr><th>Payment Date</th><th>Semester</th><th>Amount</th><th>Method</th><th>Transaction ID</th><th>Status</th></tr></thead><tbody>
                            <tr><td>Feb 10, 2024</td><td>Spring 2023-2024</td><td>৳ 125,000</td><td>Online Banking</td><td>TXN-2024-12548</td><td><span class="status-badge status-approved">Completed</span></td></tr>
                        </tbody></table></div></div></div>
                     <div class="semester-content" id="fall2023-finance" style="display:none;"> <p class="no-results">Financial details for Fall 2022-2023 are not shown in this mock.</p> </div>
                </div>
            </section>

            <!-- Student Profile Page (Original Structure) -->
            <section id="profile" class="page-content" style="display: none;">
                <h2 class="page-title"><i class="fas fa-user-graduate"></i> Student Profile</h2>
                <div class="form-row"><div class="form-col"><div class="form-group"><label for="studentId">Student ID</label><input type="text" id="studentId" class="form-control" value="21-123456-1" readonly></div></div><div class="form-col"><div class="form-group"><label for="program">Program</label><input type="text" id="program" class="form-control" value="BSc in Computer Science & Engineering" readonly></div></div></div>
                <div class="form-row"><div class="form-col"><div class="form-group"><label for="fullName">Full Name</label><input type="text" id="fullName" class="form-control" value="Sarah Ahmed" readonly></div></div><div class="form-col"><div class="form-group"><label for="email">Email</label><input type="email" id="email" class="form-control" value="sarah.ahmed@student.aiub.edu" readonly></div></div></div>
                <div class="form-row"><div class="form-col"><div class="form-group"><label for="phone">Phone</label><input type="tel" id="phone" class="form-control" value="+880 1712 345678" readonly></div></div><div class="form-col"><div class="form-group"><label for="birthdate">Date of Birth</label><input type="date" id="birthdate" class="form-control" value="2001-05-15" readonly></div></div></div>
                <div class="form-group"><label for="address">Address</label><textarea id="address" class="form-control" rows="3" readonly>123/A, Road 7, Banani, Dhaka</textarea></div>
                <div class="form-row"><div class="form-col"><div class="form-group"><label for="admissionDate">Admission Date</label><input type="text" id="admissionDate" class="form-control" value="Spring 2021" readonly></div></div><div class="form-col"><div class="form-group"><label for="expectedGrad">Expected Graduation</label><input type="text" id="expectedGrad" class="form-control" value="Fall 2024" readonly></div></div></div>
                <div class="form-group"><label for="emergencyContact">Emergency Contact</label><input type="text" id="emergencyContact" class="form-control" value="Mr. Ahmed Rahman (Father) - +880 1711 987654" readonly></div>
                <h3 style="margin: 1.5rem 0 1rem; color: var(--primary); font-size: 1.3rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem;">Academic Information</h3>
                <div class="form-row"><div class="form-col"><div class="form-group"><label for="cgpa">Cumulative GPA</label><input type="text" id="cgpa" class="form-control" value="3.89" readonly></div></div><div class="form-col"><div class="form-group"><label for="creditsCompleted">Credits Completed</label><input type="text" id="creditsCompleted" class="form-control" value="112" readonly></div></div></div>
                <div class="action-buttons"><button class="btn" id="request-change-btn"><i class="fas fa-edit"></i> Request Profile Change</button><button class="btn"><i class="fas fa-file-pdf"></i> Download Profile</button></div>
                <div class="change-form" id="change-request-form"><h3>Request Profile Change</h3><div class="form-group"><label for="changeField">Field to Change</label><select id="changeField" class="form-control"><option value="">Select field</option><option value="phone">Phone Number</option><option value="email">Email Address</option><option value="address">Home Address</option><option value="emergency">Emergency Contact</option></select></div><div class="form-group"><label for="currentValue">Current Value</label><input type="text" id="currentValue" class="form-control" readonly></div><div class="form-group"><label for="newValue">New Value</label><input type="text" id="newValue" class="form-control"></div><div class="form-group"><label for="changeReason">Reason for Change</label><textarea id="changeReason" class="form-control" rows="3"></textarea></div><div class="action-buttons"><button class="btn"><i class="fas fa-paper-plane"></i> Submit Request</button><button class="btn btn-secondary" id="cancel-change-btn">Cancel</button></div></div>
            </section>

            <!-- Applications Page (Enhanced) -->
            <section id="applications-page" class="page-content" style="display: none;">
                <h2 class="page-title"><i class="fas fa-clipboard-list"></i> Applications Hub</h2>
                 <div class="card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h2><i class="fas fa-tasks"></i> Application Status</h2>
                    </div>
                    <div class="card-body" id="application-status-card-content">
                        <p class="no-results dynamic-status" style="display:none;">No active applications or recent statuses.</p>
                    </div>
                </div>

                <div class="application-cards-container">
                    <a href="#drop-course-application-page" class="application-card data-nav-link">
                        <div class="app-icon"><i class="fas fa-minus-circle"></i></div>
                        <h3>Course Drop Application</h3>
                        <p>Request to drop one or more registered courses for the current semester.</p>
                        <div class="btn btn-primary"><i class="fas fa-arrow-right"></i> Apply Now</div>
                    </a>
                    <div class="application-card"> <div class="app-icon"><i class="fas fa-exchange-alt"></i></div> <h3>Program Change</h3> <p>Apply to change your current academic program.</p> <button class="btn btn-primary"><i class="fas fa-arrow-right"></i> Apply</button> </div>
                    <div class="application-card"> <div class="app-icon"><i class="fas fa-stream"></i></div> <h3>Major Change</h3> <p>Request to change your major specialization.</p> <button class="btn btn-primary"><i class="fas fa-arrow-right"></i> Apply</button> </div>
                    <div class="application-card"> <div class="app-icon"><i class="fas fa-graduation-cap"></i></div> <h3>Convocation Application</h3> <p>Apply for graduation and convocation.</p> <button class="btn btn-primary"><i class="fas fa-arrow-right"></i> Apply</button> </div>
                    <div class="application-card"> <div class="app-icon"><i class="fas fa-award"></i></div> <h3>Scholarship Application</h3> <p>Apply for various scholarships offered.</p> <button class="btn btn-primary"><i class="fas fa-arrow-right"></i> Apply</button> </div>
                    <div class="application-card"> <div class="app-icon"><i class="fas fa-id-card"></i></div> <h3>ID Card Requisition</h3> <p>Request for a new or replacement ID card.</p> <button class="btn btn-primary"><i class="fas fa-arrow-right"></i> Apply</button> </div>
                </div>
            </section>
            
            <!-- Drop Course Application Page (New) -->
            <section id="drop-course-application-page" class="page-content" style="display:none;">
                <h2 class="page-title"><i class="fas fa-minus-circle"></i> Course Drop Application</h2>
                <div id="current-semester-courses-for-drop">
                    <h3>Your Registered Courses for <span id="drop-app-current-semester-name">Spring 2023-2024</span>:</h3>
                    <div id="drop-course-list" class="table-container" style="margin-top:1rem;">
                        <p class="no-results">You have no courses registered for the current semester to drop.</p>
                    </div>
                </div>
                <hr style="margin: 2rem 0;">
                <div id="drop-request-history">
                    <h3><i class="fas fa-history"></i> Drop Request History</h3>
                    <div id="drop-history-table-container" class="table-container" style="margin-top:1rem;">
                        <p class="no-results">No drop request history found.</p>
                    </div>
                </div>
            </section>


            <!-- Curriculum Page (Enhanced Styles) -->
            <section id="curriculum" class="page-content" style="display: none;">
                <h2 class="page-title"><i class="fas fa-sitemap"></i> Curriculum - BSc in CS&E</h2>
                <div class="curriculum-semester"><h3><i class="fas fa-layer-group"></i> Semester 1: Foundation</h3><ul class="curriculum-courses"><li><div class="course-code-title"><i class="fas fa-atom"></i> PHY 1101 - Physics I</div> <span class="course-credits">3 Credits</span></li><li><div class="course-code-title"><i class="fas fa-flask"></i> PHY 1102 - Physics I Lab</div> <span class="course-credits">1 Credit</span></li><li><div class="course-code-title"><i class="fas fa-calculator"></i> MAT 1102 - Differential Calculus & Co-ordinate Geometry</div> <span class="course-credits">3 Credits</span></li><li><div class="course-code-title"><i class="fas fa-comments"></i> ENG 1101 - English Reading Skills & Public Speaking</div> <span class="course-credits">3 Credits</span></li><li><div class="course-code-title"><i class="fas fa-desktop"></i> CSC 1101 - Introduction to Computer Studies</div> <span class="course-credits">1 Credit</span></li></ul></div>
                <div class="curriculum-semester"><h3><i class="fas fa-layer-group"></i> Semester 2: Programming Fundamentals</h3><ul class="curriculum-courses"><li><div class="course-code-title"><i class="fas fa-code"></i> CSC 1203 - Programming Language I (Structured)</div> <span class="course-credits">3 Credits</span></li><li><div class="course-code-title"><i class="fas fa-laptop-code"></i> CSC 1204 - Programming Language I Lab</div> <span class="course-credits">1 Credit</span></li><li><div class="course-code-title"><i class="fas fa-infinity"></i> MAT 1205 - Integral Calculus & ODE</div> <span class="course-credits">3 Credits</span></li><li><div class="course-code-title"><i class="fas fa-pen-alt"></i> ENG 1202 - English Writing Skills & Communication</div> <span class="course-credits">3 Credits</span></li><li><div class="course-code-title"><i class="fas fa-bolt"></i> EEE 1208 - Electrical Circuits Analysis Lab</div> <span class="course-credits">1 Credit</span></li></ul></div>
            </section>

            <!-- Exam Schedule Page (More Content) -->
            <section id="exam-schedule" class="page-content" style="display: none;">
                <h2 class="page-title"><i class="fas fa-calendar-check"></i> Exam Schedule</h2>
                <div class="exam-tabs">
                    <button class="exam-tab active" data-exam-type="quiz">Quizzes</button>
                    <button class="exam-tab" data-exam-type="midterm">Midterm Exams</button>
                    <button class="exam-tab" data-exam-type="final">Final Exams</button>
                </div>
                <div id="quiz-exams" class="exam-content active"><h3>Upcoming Quizzes - Spring 2023-2024</h3><div class="exam-item"><h4>CSE 3205 - Software Engineering - Quiz 2</h4><p><i class="fas fa-calendar-day"></i> Date: April 02, 2024</p><p><i class="fas fa-clock"></i> Time: 10:00 AM (During class)</p><p><i class="fas fa-map-marker-alt"></i> Room: D-502</p><p><i class="fas fa-book-reader"></i> Syllabus: Chapter 3, 4</p></div><div class="exam-item"><h4>MAT 3109 - Numerical Methods - Quiz 1</h4><p><i class="fas fa-calendar-day"></i> Date: April 05, 2024</p><p><i class="fas fa-clock"></i> Time: 09:00 AM (During class)</p><p><i class="fas fa-map-marker-alt"></i> Room: B-102</p><p><i class="fas fa-book-reader"></i> Syllabus: Root Finding Methods</p></div></div>
                <div id="midterm-exams" class="exam-content"><h3>Midterm Examination Schedule - Spring 2023-2024</h3><div class="exam-item"><h4>CSE 3107 - Database Systems</h4><p><i class="fas fa-calendar-day"></i> Date: April 10, 2024 (Sunday)</p><p><i class="fas fa-clock"></i> Time: 12:00 PM - 01:30 PM</p><p><i class="fas fa-map-marker-alt"></i> Room: C-303</p></div><div class="exam-item"><h4>CSE 3205 - Software Engineering</h4><p><i class="fas fa-calendar-day"></i> Date: April 11, 2024 (Tuesday)</p><p><i class="fas fa-clock"></i> Time: 10:00 AM - 11:30 AM</p><p><i class="fas fa-map-marker-alt"></i> Room: D-502</p></div><div class="exam-item"><h4>PHY 1101 - Physics I</h4><p><i class="fas fa-calendar-day"></i> Date: April 12, 2024 (Wednesday)</p><p><i class="fas fa-clock"></i> Time: 02:00 PM - 03:30 PM</p><p><i class="fas fa-map-marker-alt"></i> Room: A-201 (Annex 2)</p></div></div>
                <div id="final-exams" class="exam-content"><h3>Final Examination Schedule - Spring 2023-2024</h3><p style="text-align: center; padding: 1rem; background-color: #fff3cd; border-radius: var(--border-radius); color: #856404;"><i class="fas fa-info-circle"></i> Final exam schedule for Spring 2023-2024 will be published around <strong>May 15, 2024</strong>. Please check back later.</p><h4 style="margin-top: 2rem; color: var(--primary-dark);">Reference: Fall 2022-2023 Final Schedule</h4><div class="exam-item"><h4>CSE 2203 - Data Structures</h4><p><i class="fas fa-calendar-day"></i> Date: December 18, 2023 (Monday)</p><p><i class="fas fa-clock"></i> Time: 09:00 AM - 11:00 AM</p><p><i class="fas fa-map-marker-alt"></i> Auditorium</p></div><div class="exam-item"><h4>MAT 2107 - Probability & Statistics</h4><p><i class="fas fa-calendar-day"></i> Date: December 20, 2023 (Wednesday)</p><p><i class="fas fa-clock"></i> Time: 01:00 PM - 03:00 PM</p><p><i class="fas fa-map-marker-alt"></i> Room: D-Building, Floor 4</p></div></div>
            </section>
            
            <!-- Academic Calendar Page (New) -->
            <section id="academic-calendar-page" class="page-content" style="display: none;">
                <h2 class="page-title"><i class="fas fa-calendar-week"></i> Academic Calendar</h2>
                <div class="calendar-controls">
                    <button id="prev-month-btn"><i class="fas fa-chevron-left"></i> Prev</button>
                    <div id="month-year-display">Month Year</div>
                    <button id="next-month-btn">Next <i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-header-cell">Sun</div>
                    <div class="calendar-header-cell">Mon</div>
                    <div class="calendar-header-cell">Tue</div>
                    <div class="calendar-header-cell">Wed</div>
                    <div class="calendar-header-cell">Thu</div>
                    <div class="calendar-header-cell">Fri</div>
                    <div class="calendar-header-cell">Sat</div>
                    <!-- Day cells will be populated by JS -->
                </div>
                <div id="calendar-event-details-popup" class="modal" style="display:none; padding-top:10%;">
                     <div class="modal-content" style="max-width:500px;">
                        <div class="modal-header">
                            <h3 class="modal-title" id="calendar-event-popup-title">Event Details</h3>
                            <button class="close-modal" id="close-calendar-event-popup">&times;</button>
                        </div>
                        <div class="modal-body" id="calendar-event-popup-body">
                            <!-- Event details will be populated here -->
                        </div>
                    </div>
                </div>
            </section>


            <!-- Registration Schedule Page -->
            <section id="registration-schedule" class="page-content" style="display: none;">
                <h2 class="page-title"><i class="fas fa-edit"></i> Course Registration</h2>

                <!-- Selected Courses for Registration Area -->
                <div id="selected-courses-for-registration-container" style="margin-bottom: 2rem;">
                    <h3 style="color: var(--primary); margin-bottom: 1rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem;">
                        <i class="fas fa-shopping-cart"></i> Your Selected Courses (Pending Confirmation)
                    </h3>
                    <div id="selected-courses-list" class="registration-course-list">
                        <p class="no-results">No courses selected yet. Add courses from the list below.</p>
                    </div>
                    <div style="text-align: right; margin-top: 1.5rem;" id="final-confirm-button-container">
                        <!-- Confirm button will be dynamically shown/hidden here by JS -->
                    </div>
                </div>
                <hr style="margin: 0 0 2rem 0;">


                <div id="registration-main-view">
                    <div class="search-container">
                        <input type="text" id="program-course-search-input" placeholder="Search available program courses (e.g., CSE3205)...">
                    </div>
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">Select a Course to View Offered Sections:</h3>
                    <div class="program-course-list-container" id="program-courses-list">
                        <!-- Program courses will be dynamically inserted here -->
                    </div>
                </div>

                <div id="offered-sections-view" style="display: none;">
                     <button class="btn btn-outline back-to-courses-btn" id="back-to-all-courses-btn"><i class="fas fa-arrow-left"></i> Back to All Available Courses</button>
                    <h3 id="offered-sections-title">Offered Sections</h3>
                     <div class="search-container">
                        <input type="text" id="section-search-input" placeholder="Filter sections by faculty, time, room...">
                    </div>
                    <div class="registration-course-list" id="registration-course-list-container">
                        <p class="no-results" style="display:none;">No sections found for this course or your filter.</p>
                        <!-- Offered section cards will be dynamically inserted here -->
                    </div>
                </div>
            </section>

        </div>
    </div>

    <!-- Course Details Modal -->
    <div class="modal" id="course-modal">
        <div class="modal-content">
            <div class="modal-header"><h3 class="modal-title"><i class="fas fa-book-reader"></i> <span id="course-modal-title-text">Course Details</span></h3><button class="close-modal">&times;</button></div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <button class="modal-tab active" data-tab="overview"><i class="fas fa-info-circle"></i> Overview</button>
                    <button class="modal-tab" data-tab="faculty"><i class="fas fa-chalkboard-teacher"></i> Faculty</button>
                    <button class="modal-tab" data-tab="consulting"><i class="fas fa-headset"></i> Consulting</button>
                    <button class="modal-tab" data-tab="notes"><i class="fas fa-sticky-note"></i> Notes</button>
                    <button class="modal-tab" data-tab="assignments"><i class="fas fa-tasks"></i> Assignments</button>
                    <button class="modal-tab" data-tab="notices"><i class="fas fa-bullhorn"></i> Notices</button>
                    <button class="modal-tab" data-tab="results-breakdown"><i class="fas fa-poll"></i> Results</button>
                </div>
                <div class="tab-content active" id="overview-tab"><h4><i class="fas fa-info-circle"></i> Course Information</h4><div class="form-row"><div class="form-col"><div class="form-group"><label>Course Code</label><input type="text" class="form-control modal-course-code" readonly></div></div><div class="form-col"><div class="form-group"><label>Course Title</label><input type="text" class="form-control modal-course-title-input" readonly></div></div></div><div class="form-row"><div class="form-col"><div class="form-group"><label>Credit Hours</label><input type="text" class="form-control modal-course-credit" readonly></div></div><div class="form-col"><div class="form-group"><label>Section</label><input type="text" class="form-control modal-course-section" readonly></div></div></div><div class="form-group"><label>Course Description</label><textarea class="form-control modal-course-desc" rows="4" readonly></textarea></div><div class="form-row"><div class="form-col"><div class="form-group"><label>Class Time</label><input type="text" class="form-control modal-course-time" readonly></div></div><div class="form-col"><div class="form-group"><label>Room</label><input type="text" class="form-control modal-course-room" readonly></div></div></div></div>
                <div class="tab-content" id="faculty-tab"><div class="faculty-info"><div class="faculty-avatar"><i class="fas fa-user-graduate"></i></div><div class="faculty-details"><h4 class="modal-faculty-name"></h4><p class="modal-faculty-title-dept"></p><p><strong>Email:</strong> <span class="modal-faculty-email"></span></p><p><strong>Phone:</strong> <span class="modal-faculty-phone"></span></p><p><strong>Office:</strong> <span class="modal-faculty-office"></span></p><p><strong>Education:</strong> <span class="modal-faculty-education"></span></p></div></div></div>
                <div class="tab-content" id="consulting-tab"><h4><i class="far fa-clock"></i> Consulting Hours</h4><div class="consulting-schedule"><div class="consulting-item"><div><strong>Monday</strong></div><div>2:00 PM - 4:00 PM</div></div><div class="consulting-item"><div><strong>Wednesday</strong></div><div>10:00 AM - 12:00 PM</div></div></div><div class="action-buttons" style="margin-top: 1.5rem;"><button class="btn"><i class="fas fa-calendar-plus"></i> Schedule Appointment</button></div></div>
                <div class="tab-content" id="notes-tab"><h4><i class="fas fa-book-open"></i> Course Notes & Materials</h4><div class="note-item"><div class="note-title"><i class="far fa-file-pdf"></i> Chapter 1: Introduction to SE</div><div class="note-meta"><i class="fas fa-calendar-alt"></i> Mar 1, 2024 &nbsp;&nbsp; <i class="fas fa-database"></i> 2.5 MB</div><a href="#" class="btn btn-sm btn-outline" download><i class="fas fa-download"></i> Download</a></div></div>
                <div class="tab-content" id="assignments-tab"><h4><i class="fas fa-clipboard-check"></i> Assignments</h4><div class="assignment-item"><div class="assignment-title"><i class="fas fa-file-signature"></i> Assignment 1: Requirement Analysis</div><div class="assignment-due-date"><i class="fas fa-calendar-times"></i> Due: March 20, 2024, 11:59 PM</div><p>Status: <span class="assignment-status submitted"><i class="fas fa-check-circle"></i> Submitted</span></p><a href="#" class="btn btn-sm btn-outline" download><i class="fas fa-download"></i> Specs</a></div><div class="assignment-item"><div class="assignment-title"><i class="fas fa-file-signature"></i> Assignment 2: System Design</div><div class="assignment-due-date"><i class="fas fa-calendar-times"></i> Due: April 10, 2024, 11:59 PM</div><p>Status: <span class="assignment-status pending"><i class="fas fa-hourglass-half"></i> Pending</span></p><a href="#" class="btn btn-sm btn-outline" download><i class="fas fa-download"></i> Specs</a><div class="upload-area"><p>Upload (PDF, DOCX, ZIP - Max 10MB)</p><input type="file" class="form-control" style="padding:5px; font-size:0.85rem;"><button class="btn btn-sm btn-success" style="margin-top:0.5rem;"><i class="fas fa-upload"></i> Upload</button></div></div></div>
                <div class="tab-content" id="notices-tab"><h4><i class="fas fa-bullhorn"></i> Course Notices</h4><div class="notice-item"><div class="notice-title"><i class="fas fa-exclamation-circle"></i> Midterm Exam Schedule</div><div class="notice-date"><i class="fas fa-calendar"></i> March 18, 2024</div><div class="announcement-content">The midterm exam will be held on March 25, 2024.</div></div></div>
                <div class="tab-content" id="results-breakdown-tab"><h4><i class="fas fa-graduation-cap"></i> Assessment Breakdown</h4><div class="table-container"><table class="modal-assessment-table"><thead><tr><th>Assessment Type</th><th>Weight</th><th>Score</th><th>Max Score</th></tr></thead><tbody class="modal-assessment-table-body"></tbody></table></div></div>
            </div>
        </div>
    </div>
     <!-- Toast Notification Placeholder -->
    <div id="toast-notification" class="toast-notification"></div>


    <!-- Footer Section (Original) -->
    <footer>
        <div class="footer-container">
            <div class="footer-section"><h3>Quick Links</h3><ul class="footer-links"><li><a href="#"><i class="fas fa-calendar-alt"></i> Academic Calendar</a></li><li><a href="#class-schedule-page"><i class="fas fa-table"></i> Class Schedule</a></li><li><a href="#exam-schedule"><i class="fas fa-file-alt"></i> Exam Schedule</a></li><li><a href="#"><i class="fas fa-book"></i> Course Catalog</a></li><li><a href="#"><i class="fas fa-book-open"></i> Library Resources</a></li></ul></div>
            <div class="footer-section"><h3>Student Services</h3><ul class="footer-links"><li><a href="#"><i class="fas fa-briefcase"></i> Career Services</a></li><li><a href="#"><i class="fas fa-comments"></i> Counseling Center</a></li><li><a href="#"><i class="fas fa-graduation-cap"></i> Financial Aid</a></li><li><a href="#"><i class="fas fa-heartbeat"></i> Health Services</a></li><li><a href="#"><i class="fas fa-users"></i> Student Clubs</a></li></ul></div>
            <div class="footer-section"><h3>Contact Us</h3><ul class="footer-links"><li><i class="fas fa-phone"></i> +880 1234-567890</li><li><i class="fas fa-envelope"></i> info@aiub.edu</li><li><i class="fas fa-map-marker-alt"></i> 408/1, Kuratoli, Khilkhet, Dhaka 1229, Bangladesh</li></ul></div>
            <div class="footer-section"><h3>Emergency Contacts</h3><ul class="footer-links"><li><i class="fas fa-shield-alt"></i> Campus Security: +880 1711-223344</li><li><i class="fas fa-ambulance"></i> Medical Emergency: 199</li><li><i class="fas fa-fire-extinguisher"></i> Fire Service: 101</li></ul></div>
        </div>
        <div class="copyright">&copy; 2023 American International University-Bangladesh. All Rights Reserved.</div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Global State & Configuration ---
            const currentAcademicSemesterKey = "spring2024"; 
            const studentID = "21-123456-1"; 
            const semesterNames = {
                "spring2024": "Spring 2023-2024",
                "fall2023": "Fall 2022-2023",
                "summer2023": "Summer 2022-2023"
            };

            let studentRegisteredCourses = [
                { semester: "spring2024", courseCode: "CSE3205", title: "Software Engineering", credit: 3.0, section: "A", time: "TTh 10:00-11:30", room: "D-502", faculty: "Dr. Rahman", grade: "IP", gradePoint: null },
                { semester: "spring2024", courseCode: "CSE3107", title: "Database Systems", credit: 3.0, section: "B", time: "ST 12:00-01:30", room: "C-303", faculty: "Prof. Khan", grade: "IP", gradePoint: null },
                { semester: "spring2024", courseCode: "MAT3109", title: "Numerical Methods", credit: 3.0, section: "C", time: "M 09:00-10:30", room: "B-102", faculty: "Dr. Hasan", grade: "IP", gradePoint: null },
                { semester: "fall2023", courseCode: "CSE2201", title: "Object Oriented Programming", credit: 3.0, section: "B", time: "MW 08:30-10:00", room: "C-401", faculty: "Dr. Akhtar", grade: "A+", gradePoint: 4.00 },
                { semester: "fall2023", courseCode: "EEE2104", title: "Electronic Devices", credit: 3.0, section: "A", time: "ST 10:00-11:30", room: "E-301", faculty: "Prof. Barua", grade: "A-", gradePoint: 3.75 },
            ];
            let courseDropRequests = []; 
            let tempSelectedCourses = []; // NEW: For courses selected before confirmation
            
            const allPages = document.querySelectorAll('.page-content, #dashboard');
            const navLinks = document.querySelectorAll('.nav-menu a, .sidebar-menu a, .user-profile a, .application-card.data-nav-link, .action-buttons a.btn.data-nav-link');
            const courseModal = document.getElementById('course-modal');
            const closeModalBtn = courseModal.querySelector('.close-modal');
            const modalTabs = courseModal.querySelectorAll('.modal-tab');
            const courseModalTitleText = document.getElementById('course-modal-title-text');

            // --- Page Navigation ---
            function showPage(pageIdToShow) {
                allPages.forEach(page => page.style.display = 'none');
                const targetPage = document.querySelector(pageIdToShow);
                
                if (targetPage) {
                    targetPage.style.display = 'block';
                    if (pageIdToShow === '#registered-courses' && document.getElementById('registered-courses-semester-filter')) {
                        renderRegisteredCoursesTable(document.getElementById('registered-courses-semester-filter').value);
                    } else if (pageIdToShow === '#academic-results' && document.getElementById('results-semester-filter')) {
                         renderAcademicResults(document.getElementById('results-semester-filter').value);
                    } else if (pageIdToShow === '#drop-course-application-page') {
                        renderDropApplicationPage();
                    } else if (pageIdToShow === '#applications-page') {
                        updateApplicationStatusCard();
                    } else if (pageIdToShow === '#class-schedule-page' && document.getElementById('class-schedule-semester')) {
                        loadClassSchedule(document.getElementById('class-schedule-semester').value);
                    } else if (pageIdToShow === '#academic-calendar-page') {
                        generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
                    } else if (pageIdToShow === '#registration-schedule') {
                        renderSelectedCoursesForRegistration(); // Render initially empty or with temp items
                        displayProgramCourses();
                        if (offeredSectionsView) offeredSectionsView.style.display = 'none';
                        if (registrationMainView) registrationMainView.style.display = 'block';
                    } else if (pageIdToShow === '#dashboard') {
                        loadDashboardData(); 
                    }
                } else if (pageIdToShow === '#dashboard' || pageIdToShow === '#') {
                    document.getElementById('dashboard').style.display = 'block';
                    loadDashboardData();
                } else { 
                    console.warn(`Page with ID ${pageIdToShow} not found. Defaulting to dashboard.`);
                    document.getElementById('dashboard').style.display = 'block';
                    loadDashboardData();
                    setActiveLink('#dashboard'); 
                }
                window.scrollTo(0, 0);
            }

            function setActiveLink(targetId) {
                if (targetId === '#') targetId = '#dashboard';
                navLinks.forEach(lnk => lnk.classList.remove('active'));
                document.querySelectorAll(`.nav-menu a[href="${targetId}"], .sidebar-menu a[href="${targetId}"], .application-card.data-nav-link[href="${targetId}"], .action-buttons a.btn.data-nav-link[href="${targetId}"]`).forEach(actLink => actLink.classList.add('active'));
                const userProfileIconParent = document.querySelector('.user-profile');
                if (userProfileIconParent) {
                    userProfileIconParent.classList.toggle('active-parent', targetId === '#profile');
                }
            }

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    let targetId = this.getAttribute('href');
                    if (targetId && targetId.startsWith('#')) {
                        e.preventDefault();
                        if (targetId === '#') targetId = '#dashboard';
                        showPage(targetId);
                        setActiveLink(targetId);
                        window.location.hash = targetId; 
                    }
                });
            });
            
            // --- Mock Data & Helper Functions ---
            const weeklySchedulesData = { 
                "spring2024": [ 
                    { day: "Sunday", icon: "fa-sun", classes: [] }, 
                    { day: "Monday", icon: "fa-cloud", classes: [] }, 
                    { day: "Tuesday", icon: "fa-calendar-day", current: true, classes: [] }, 
                    { day: "Wednesday", icon: "fa-cloud-sun", classes: [] }, 
                    { day: "Thursday", icon: "fa-cloud-rain", classes: [] } 
                ],
                "fall2023": [ { day: "Monday", icon: "fa-sun", classes: [ { code: "CSE2201", title: "OOP", time: "MW 08:30-10:00", room: "D-101", type: "lecture" } ] }, { day: "Wednesday", icon: "fa-calendar-day", classes: [ { code: "EEE2104", title: "Electronic Devices", time: "ST 10:00-11:30", room: "E-301", type: "lecture" } ] }, ],
                "summer2023": [ { day: "Tuesday", icon: "fa-cloud", classes: [ { code: "ENG101", title: "English I", time: "TTh 11:00-12:30", room: "E-205", type: "lecture" } ] }, ]
            };
            const coursesData = { 
                "CSE3205": { title: "Software Engineering", credit: 3.0, section: "A", desc: "Fundamental principles and practices of software engineering...", time: "TTh 10:00-11:30", room: "D-502", facultyName: "Dr. Rahman", assessments: [{type: "Midterm", weight:"25%", score:"IP", max:"25"}, {type: "Final", weight:"40%", score:"IP", max:"40"}, {type:"Quizzes", weight:"15%", score:"IP", max:"15"}, {type:"Project", weight:"20%", score:"IP", max:"20"}]},
                "CSE3107": { title: "Database Systems", credit: 3.0, section: "B", desc: "Core concepts of database systems...", time: "ST 12:00-01:30", room: "C-303", facultyName: "Prof. Khan", assessments: [{type: "Midterm", weight:"30%", score:"IP", max:"30"}, {type: "Final", weight:"40%", score:"IP", max:"40"}, {type:"Assignments", weight:"30%", score:"IP", max:"30"}]},
                "MAT3109": { title: "Numerical Methods", credit: 3.0, section: "C", desc: "Numerical techniques for solving mathematical problems...", time: "M 09:00-10:30", room: "B-102", facultyName: "Dr. Hasan", assessments: []},
                "CSE3111": { title: "Computer Networks", credit: 3.0, section: "C", desc: "Introduction to computer networks...", time: "ST 02:00-03:30", room: "B-407", facultyName: "Dr. Islam", assessments: []},
                "CSE3203": { title: "Algorithms", credit: 3.0, section: "A", desc: "Design and analysis of algorithms...", time: "ST 04:00-05:30", room: "A-205", facultyName: "Prof. Ahmed", assessments: []},
                "CSE3205L": { title: "Software Engineering Lab", credit: 1.0, section: "L1", desc: "Lab sessions for SE...", time: "W 01:00-03:00", room: "Lab-5", facultyName: "Mr. X", assessments: []},
                "CSE3111L": { title: "Computer Networks Lab", credit: 1.0, section: "L2", desc: "Lab sessions for Networks...", time: "Th 09:00-11:00", room: "Lab-3", facultyName: "Ms. Y", assessments: []},
                "CSE2201": { title: "Object Oriented Programming", credit: 3.0, section: "B", desc: "OOP concepts...", time: "MW 08:30-10:00", room: "C-401", facultyName: "Dr. Akhtar", assessments: [{type: "Midterm", weight:"25%", score:"23", max:"25"}, {type: "Final", weight:"40%", score:"38", max:"40"}]},
                "EEE2104": { title: "Electronic Devices & Circuits", credit: 3.0, section: "A", desc: "Study of electronic devices...", time: "ST 10:00-11:30", room: "E-301", facultyName: "Prof. Barua", assessments: [{type: "Midterm", weight:"30%", score:"25", max:"30"}, {type: "Final", weight:"50%", score:"42", max:"50"}]},
                "PHY1101": { title: "Physics I", credit: 3.0, section: "A", desc: "Fundamental physics concepts...", time: "MW 09:00-10:30", room: "P-101", facultyName: "Dr. Z", assessments: [] },
                "ENG101": { title: "English I", credit: 3.0, section: "E", desc: "Basic English skills...", time: "TTh 11:00-12:30", room: "E-101", facultyName: "Ms. W", assessments: [] },
                "CSE1101": { title: "Introduction to Computer Studies", credit: 1.0, desc: "Basic computer literacy...", facultyName:"TBA", assessments: []},
                "CSE1203": { title: "Programming Language I (Java)", credit: 3.0, desc: "Fundamentals of programming using Java.", facultyName:"TBA", assessments: []},
                "MAT1102": { title: "Differential Calculus & Co-ordinate Geometry", credit: 3.0, desc: "Calculus and analytical geometry.", facultyName:"TBA", assessments: []},
                "ENG1101": { title: "English Reading & Speaking", credit: 3.0, desc: "Developing English reading and oral communication skills.", facultyName:"TBA", assessments: []},
                "CSE2108": { title: "Data Structures", credit: 3.0, desc: "Fundamental data structures...", facultyName:"TBA", assessments: []},
                "CSE2215": { title: "Computer Architecture", credit: 3.0, desc: "Organization and architecture of computer systems.", facultyName:"TBA", assessments: []},
                "CSE4100": { title: "Web Technologies", credit: 3.0, desc: "Client-side and server-side web development.", facultyName:"TBA", assessments: []},
                "CSE4200": { title: "Artificial Intelligence", credit: 3.0, desc: "Introduction to AI concepts...", facultyName:"TBA", assessments: []},
            };
            const programCoursesData = [ 
                { code: "CSE1101", title: "Introduction to Computer Studies", credits: 1.0 }, { code: "CSE1203", title: "Programming Language I (Java)", credits: 3.0 },
                { code: "MAT1102", title: "Differential Calculus & Co-ordinate Geometry", credits: 3.0 }, { code: "PHY1101", title: "Physics I", credits: 3.0 },
                { code: "ENG1101", title: "English Reading & Speaking", credits: 3.0 }, { code: "CSE2108", title: "Data Structures", credits: 3.0 },
                { code: "CSE2215", title: "Computer Architecture", credits: 3.0 }, { code: "EEE2104", title: "Electronic Devices & Circuits", credits: 3.0 },
                { code: "CSE3205", title: "Software Engineering", credits: 3.0 }, { code: "CSE3107", title: "Database Systems", credits: 3.0 },
                { code: "CSE3111", title: "Computer Networks", credits: 3.0 }, { code: "CSE3203", title: "Algorithms", credits: 3.0 },
                { code: "MAT3109", title: "Numerical Methods", credits: 3.0 }, { code: "CSE4100", title: "Web Technologies", credits: 3.0 },
                { code: "CSE4200", title: "Artificial Intelligence", credits: 3.0 },
            ];
            const allOfferedSectionsData = [ 
                { courseCode: "CSE3205", section: "A", time: "TTh 10:00-11:30", room: "D-502", faculty: "Dr. Rahman", enrolled: 35, capacity: 40 },
                { courseCode: "CSE3205", section: "B", time: "MW 02:00-03:30", room: "D-503", faculty: "Dr. Eva", enrolled: 20, capacity: 40 },
                { courseCode: "CSE3205", section: "C", time: "ST 08:30-10:00", room: "D-504", faculty: "Mr. Kabir", enrolled: 39, capacity: 40 },
                { courseCode: "CSE3107", section: "B", time: "ST 12:00-01:30", room: "C-303", faculty: "Prof. Khan", enrolled: 38, capacity: 40 }, 
                { courseCode: "CSE3107", section: "C", time: "TTh 08:30-10:00", room: "C-304", faculty: "Mr. Alam", enrolled: 15, capacity: 35 },
                { courseCode: "MAT3109", section: "C", time: "M 09:00-10:30", room: "B-102", faculty: "Dr. Hasan", enrolled: 25, capacity: 30 }, 
                { courseCode: "PHY1101", section: "D", time: "TTh 01:00-02:30", room: "A-101", faculty: "Prof. Alam", enrolled: 40, capacity: 40 },
                { courseCode: "PHY1101", section: "E", time: "MW 10:00-11:30", room: "A-102", faculty: "Dr. Selim", enrolled: 25, capacity: 30 },
                { courseCode: "CSE1203", section: "F", time: "ST 04:00-05:30", room: "B-201", faculty: "Ms. Nadia", enrolled: 30, capacity: 35 },
                { courseCode: "CSE1203", section: "G", time: "MW 11:30-01:00", room: "B-202", faculty: "Mr. Fahim", enrolled: 33, capacity: 35 },
                { courseCode: "CSE4100", section: "H", time: "TTh 02:30-04:00", room: "Lab-7", faculty: "Dr. Zaman", enrolled: 18, capacity: 25 },
                { courseCode: "MAT1102", section: "J", time: "MW 01:00-02:30", room: "Annex-101", faculty: "Dr. Binte", enrolled: 0, capacity: 30 },
                { courseCode: "MAT1102", section: "K", time: "ST 02:30-04:00", room: "Annex-102", faculty: "Mr. Rony", enrolled: 5, capacity: 30 },
                { courseCode: "ENG1101", section: "L", time: "TTh 11:30-01:00", room: "Main-E201", faculty: "Ms. Shila", enrolled: 10, capacity: 25 },
                 { courseCode: "CSE2108", section: "M", time: "ST 01:00-02:30", room: "D-202", faculty: "Dr. Hasan", enrolled: 28, capacity: 35 },
                { courseCode: "CSE2108", section: "N", time: "MW 04:00-05:30", room: "D-203", faculty: "Ms. Tania", enrolled: 12, capacity: 35 },
                { courseCode: "EEE2104", section: "P", time: "TTh 04:00-05:30", room: "E-105", faculty: "Prof. Barua", enrolled: 30, capacity: 30 }, 
                { courseCode: "CSE4200", section: "Q", time: "M 02:00-05:00", room: "Lab-AI", faculty: "Dr. Alpha", enrolled: 0, capacity: 20 }, 
                { courseCode: "CSE4200", section: "R", time: "W 09:00-12:00", room: "Lab-AI", faculty: "Dr. Beta", enrolled: 3, capacity: 20 },
            ];

            // --- Toast Notification ---
            const toastEl = document.getElementById('toast-notification');
            function showToast(message, type = 'info') { 
                if (!toastEl) return;
                toastEl.textContent = message;
                toastEl.className = 'toast-notification'; 
                toastEl.classList.add(type);
                toastEl.classList.add('show');
                setTimeout(() => { toastEl.classList.remove('show'); }, 3500);
            }

            // --- Dashboard Update Functions ---
            const dashboardScheduleContainer = document.getElementById('dashboard-schedule-content');
            const dashboardCurrentSemesterDisplay = document.getElementById('dashboard-current-semester-display');
            const dashboardQuickStatsContainer = document.getElementById('dashboard-quick-stats');

            function updateDashboardQuickStats() {
                if (!dashboardQuickStatsContainer) return;

                const currentSemesterCourses = studentRegisteredCourses.filter(c => c.semester === currentAcademicSemesterKey);
                const totalCurrentCredits = currentSemesterCourses.reduce((sum, course) => sum + course.credit, 0);
                
                let totalGradePoints = 0;
                let totalCreditsForCgpa = 0;
                studentRegisteredCourses.forEach(course => {
                    if (course.gradePoint !== null && course.grade !== "IP") {
                        totalGradePoints += course.gradePoint * course.credit;
                        totalCreditsForCgpa += course.credit;
                    }
                });
                const cgpa = totalCreditsForCgpa > 0 ? (totalGradePoints / totalCreditsForCgpa).toFixed(2) : "N/A";

                dashboardQuickStatsContainer.querySelector('[data-stat="cgpa"]').textContent = cgpa;
                dashboardQuickStatsContainer.querySelector('[data-stat="credits"]').textContent = totalCurrentCredits.toFixed(1);
            }
            
            function loadDashboardData() {
                if(dashboardScheduleContainer) {
                     dashboardScheduleContainer.innerHTML = generateScheduleHTML(weeklySchedulesData[currentAcademicSemesterKey], currentAcademicSemesterKey);
                     attachModalListenersToScheduleItems(dashboardScheduleContainer);
                }
                if (dashboardCurrentSemesterDisplay) {
                    dashboardCurrentSemesterDisplay.textContent = semesterNames[currentAcademicSemesterKey] || currentAcademicSemesterKey;
                }
                updateDashboardQuickStats();
            }


            function generateScheduleHTML(scheduleDataForSemester, semesterKey) {
                let baseSchedule = scheduleDataForSemester ? JSON.parse(JSON.stringify(scheduleDataForSemester)) : [];
                let currentRegisteredForThisSemester = studentRegisteredCourses.filter(c => c.semester === semesterKey);
                
                currentRegisteredForThisSemester.forEach(regCourse => {
                    const timeSlot = parseTimeSlot(regCourse.time); 
                    if (timeSlot) {
                        timeSlot.days.forEach(dayIndex => {
                            const dayName = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][dayIndex];
                            let dayInfo = baseSchedule.find(d => d.day === dayName);
                            if (!dayInfo) { 
                                dayInfo = { day: dayName, icon: "fa-calendar-alt", classes: [] }; 
                                baseSchedule.push(dayInfo);
                            }
                            if (!dayInfo.classes.some(c => c.code === regCourse.courseCode && c.time === regCourse.time)) {
                                dayInfo.classes.push({ 
                                    code: regCourse.courseCode, 
                                    title: regCourse.title, 
                                    time: regCourse.time, 
                                    room: regCourse.room, 
                                    type: regCourse.courseCode.toUpperCase().includes('L') ? 'lab' : 'lecture' 
                                });
                            }
                        });
                    }
                });

                baseSchedule.sort((a,b) => ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"].indexOf(a.day) - ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"].indexOf(b.day));

                if (baseSchedule.every(d => d.classes.length === 0)) return '<p class="no-results" style="text-align:center; padding:1rem;">No schedule available for this semester.</p>';
                
                let html = '';
                baseSchedule.forEach(dayInfo => {
                    if (dayInfo.classes && dayInfo.classes.length > 0) { 
                        html += `<div class="schedule-day"><div class="day-header ${dayInfo.current ? 'current-day' : ''}"><i class="fas ${dayInfo.icon || 'fa-calendar-day'}"></i> ${dayInfo.day} ${dayInfo.current ? '(Today)' : ''}</div>`;
                        dayInfo.classes.sort((a,b) => { 
                            const slotA = parseTimeSlot(a.time);
                            const slotB = parseTimeSlot(b.time);
                            return (slotA ? slotA.startTime : Infinity) - (slotB ? slotB.startTime : Infinity);
                        });
                        dayInfo.classes.forEach(cls => { html += `<div class="schedule-item ${cls.type === 'lab' ? 'lab' : ''} ${cls.currentClass ? 'current-class' : ''}" data-course-code="${cls.code}" data-course-title="${cls.title}"><div class="course-info"><div class="course-code"><i class="fas ${cls.type === 'lab' ? 'fa-flask' : 'fa-chalkboard-teacher'}"></i> ${cls.code} - ${cls.title}</div><div class="course-time"><i class="fas fa-clock"></i> ${cls.time}</div></div><div class="course-room"><i class="fas fa-door-open"></i> ${cls.room}</div></div>`; });
                        html += `</div>`;
                    }
                });
                 return html || '<p class="no-results" style="text-align:center; padding:1rem;">No classes scheduled for this semester.</p>';
            }
            

            const classScheduleSemesterSelect = document.getElementById('class-schedule-semester');
            const classScheduleContentArea = document.getElementById('class-schedule-content-area');
            const classScheduleSemesterTitle = document.getElementById('class-schedule-semester-title');
            function loadClassSchedule(semesterKey) {
                const baseScheduleData = weeklySchedulesData[semesterKey]; 
                if (classScheduleContentArea) { classScheduleContentArea.innerHTML = generateScheduleHTML(baseScheduleData, semesterKey); attachModalListenersToScheduleItems(classScheduleContentArea); }
                if (classScheduleSemesterTitle && classScheduleSemesterSelect) { const selectedOptionText = classScheduleSemesterSelect.options[classScheduleSemesterSelect.selectedIndex].text; classScheduleSemesterTitle.innerHTML = `<i class="fas fa-calendar-week"></i> Weekly Schedule - ${selectedOptionText}`; }
            }
            if (classScheduleSemesterSelect) { classScheduleSemesterSelect.addEventListener('change', function() { loadClassSchedule(this.value); }); }

            const regCoursesSemesterFilter = document.getElementById('registered-courses-semester-filter');
            const regCoursesTableContainer = document.getElementById('registered-courses-table-container');
            const regCoursesCreditSummaryEl = document.getElementById('registered-courses-credit-summary');

            function renderRegisteredCoursesTable(semesterKey) {
                const coursesForSemester = studentRegisteredCourses.filter(c => c.semester === semesterKey);
                let tableHTML = '<p class="no-results" style="text-align:center; padding:1rem;">No courses registered for this semester.</p>';
                let totalCredits = 0, theoryCredits = 0, labCredits = 0;

                if (coursesForSemester.length > 0) {
                    tableHTML = `<table><thead><tr><th>Course Code</th><th>Title</th><th>Credit</th><th>Section</th><th>Time</th><th>Room</th><th>Faculty</th><th>Details</th></tr></thead><tbody>`;
                    coursesForSemester.forEach(course => {
                        tableHTML += `<tr data-course-code="${course.courseCode}" data-course-title="${course.title}"><td>${course.courseCode}</td><td>${course.title}</td><td>${course.credit.toFixed(1)}</td><td>${course.section}</td><td>${course.time}</td><td>${course.room}</td><td>${course.faculty}</td><td><button class="btn btn-sm view-course-details-btn"><i class="fas fa-info-circle"></i> View</button></td></tr>`;
                        totalCredits += course.credit;
                        if (course.courseCode.toUpperCase().includes('L')) labCredits += course.credit; else theoryCredits += course.credit;
                    });
                    tableHTML += `</tbody></table>`;
                }
                if(regCoursesTableContainer) regCoursesTableContainer.innerHTML = tableHTML;
                if(regCoursesCreditSummaryEl) regCoursesCreditSummaryEl.innerHTML = `<div class="credit-item"><div class="credit-value">${totalCredits.toFixed(1)}</div><div class="credit-label">Total Credits</div></div><div class="credit-item"><div class="credit-value">${theoryCredits.toFixed(1)}</div><div class="credit-label">Theory Credits</div></div><div class="credit-item"><div class="credit-value">${labCredits.toFixed(1)}</div><div class="credit-label">Lab Credits</div></div><div class="credit-item"><div class="credit-value">${coursesForSemester.length}</div><div class="credit-label">Courses</div></div>`;
                
                if(regCoursesTableContainer) { 
                    regCoursesTableContainer.querySelectorAll('.view-course-details-btn').forEach(btn => btn.addEventListener('click', function() { openCourseModal(this.closest('tr').dataset.courseCode); }));
                }
            }
            if(regCoursesSemesterFilter) { regCoursesSemesterFilter.addEventListener('change', function() { renderRegisteredCoursesTable(this.value); }); }

            const resultsSemesterFilter = document.getElementById('results-semester-filter');
            const academicResultsContentArea = document.getElementById('academic-results-content-area');

            function renderAcademicResults(semesterKey) {
                if (!academicResultsContentArea) return;
                academicResultsContentArea.innerHTML = ''; 

                const coursesForSemester = studentRegisteredCourses.filter(c => c.semester === semesterKey);
                if (coursesForSemester.length === 0) {
                    academicResultsContentArea.innerHTML = '<p class="no-results">No results available for the selected semester.</p>';
                    return;
                }

                let totalCreditsTaken = 0;
                let totalCreditsEarned = 0;
                let totalGradePointsProduct = 0;

                coursesForSemester.forEach(course => {
                    totalCreditsTaken += course.credit;
                    if (course.grade !== "F" && course.grade !== "IP" && course.gradePoint !== null) { 
                        totalCreditsEarned += course.credit;
                        totalGradePointsProduct += course.gradePoint * course.credit;
                    }
                });

                const semesterGPA = totalCreditsEarned > 0 ? (totalGradePointsProduct / totalCreditsEarned).toFixed(2) : "N/A";
                
                let cumulativeGradePointsProduct = 0;
                let cumulativeCreditsEarned = 0;
                const semesterOrder = ["summer2023", "fall2023", "spring2024"]; 
                const relevantSemesters = semesterOrder.slice(0, semesterOrder.indexOf(semesterKey) + 1);

                studentRegisteredCourses.filter(c => relevantSemesters.includes(c.semester)).forEach(course => {
                    if (course.grade !== "F" && course.grade !== "IP" && course.gradePoint !== null) {
                        cumulativeGradePointsProduct += course.gradePoint * course.credit;
                        cumulativeCreditsEarned += course.credit;
                    }
                });
                const cumulativeGPA = cumulativeCreditsEarned > 0 ? (cumulativeGradePointsProduct / cumulativeCreditsEarned).toFixed(2) : "N/A";


                let resultCardHTML = `
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">${semesterNames[semesterKey] || semesterKey}</div>
                            <div class="result-semester">Semester GPA: ${semesterGPA}</div>
                        </div>
                        <div class="result-details">
                            <div class="result-item"><span class="result-label">Credits Taken</span><span class="result-value">${totalCreditsTaken.toFixed(1)}</span></div>
                            <div class="result-item"><span class="result-label">Credits Earned</span><span class="result-value">${totalCreditsEarned.toFixed(1)}</span></div>
                            <div class="result-item"><span class="result-label">Semester GPA</span><span class="result-value">${semesterGPA}</span></div>
                            <div class="result-item"><span class="result-label">Cumulative GPA</span><span class="result-value">${cumulativeGPA}</span></div>
                        </div>
                        <div class="table-container" style="margin-top: 1.5rem;">
                            <table>
                                <thead><tr><th>Course Code</th><th>Course Title</th><th>Credit</th><th>Grade</th><th>Grade Point</th><th>Details</th></tr></thead>
                                <tbody>`;
                
                coursesForSemester.forEach(course => {
                    const courseDetails = coursesData[course.courseCode];
                    const hasAssessments = courseDetails && courseDetails.assessments && courseDetails.assessments.length > 0;
                    resultCardHTML += `
                        <tr>
                            <td>${course.courseCode}</td>
                            <td>${course.title}</td>
                            <td>${course.credit.toFixed(1)}</td>
                            <td>${course.grade || "N/A"}</td>
                            <td>${course.gradePoint !== null ? course.gradePoint.toFixed(2) : "N/A"}</td>
                            <td>${hasAssessments ? `<button class="btn btn-sm view-assessment-btn" data-course-code="${course.courseCode}" data-semester="${semesterKey}">View</button>` : 'N/A'}</td>
                        </tr>`;
                });
                resultCardHTML += `</tbody></table></div></div>`;
                academicResultsContentArea.innerHTML = resultCardHTML;

                coursesForSemester.forEach(course => {
                    const courseDetails = coursesData[course.courseCode];
                     if (courseDetails && courseDetails.assessments && courseDetails.assessments.length > 0) {
                        const assessmentDivId = `${course.courseCode}-${semesterKey}-assessment`;
                        if (!document.getElementById(assessmentDivId)) {
                            const breakdownDiv = document.createElement('div');
                            breakdownDiv.className = 'assessment-breakdown';
                            breakdownDiv.id = assessmentDivId;
                            let assessmentRows = '';
                            let totalScore = 0;
                            let allScoresAreIP = true;
                            courseDetails.assessments.forEach(asm => {
                                let scoreDisplay = "N/A";
                                if (course.grade === "IP" && semesterKey === currentAcademicSemesterKey) {
                                    scoreDisplay = "IP";
                                } else if (asm.score !== undefined && asm.score !== null && asm.score !== "IP") {
                                    scoreDisplay = asm.score;
                                    totalScore += parseFloat(asm.score) || 0;
                                    allScoresAreIP = false;
                                } else if (asm.score === "IP"){
                                     scoreDisplay = "IP";
                                }
                                assessmentRows += `<tr><td>${asm.type}</td><td>${asm.weight}</td><td>${scoreDisplay}</td><td>${asm.max}</td></tr>`;
                            });

                            const totalRow = (course.grade !== "IP" || semesterKey !== currentAcademicSemesterKey) && !allScoresAreIP
                                ? `<tr style="font-weight: bold;"><td>Total</td><td>100%</td><td>${totalScore.toFixed(1)}</td><td>100</td></tr>`
                                : '';


                            breakdownDiv.innerHTML = `<h4>${courseDetails.title} (${course.courseCode}) Assessment - ${semesterNames[semesterKey] || semesterKey}</h4>
                                                    <div class="table-container">
                                                        <table>
                                                            <thead><tr><th>Assessment Type</th><th>Weight</th><th>Score</th><th>Max Score</th></tr></thead>
                                                            <tbody>
                                                            ${assessmentRows}
                                                            ${totalRow}
                                                            </tbody>
                                                        </table>
                                                    </div>`;
                            academicResultsContentArea.appendChild(breakdownDiv);
                        }
                    }
                });
                
                academicResultsContentArea.querySelectorAll('.view-assessment-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const courseCode = this.dataset.courseCode;
                        const semKey = this.dataset.semester;
                        const targetBreakdownId = `${courseCode}-${semKey}-assessment`;
                        
                        document.querySelectorAll('#academic-results-content-area .assessment-breakdown').forEach(b => b.classList.remove('active'));
                        const targetBreakdown = document.getElementById(targetBreakdownId);
                        if (targetBreakdown) {
                            targetBreakdown.classList.add('active');
                            targetBreakdown.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        } else {
                            console.warn("Assessment breakdown element not found for:", targetBreakdownId);
                            showToast("No detailed assessment breakdown available for this course/semester.", "warning");
                        }
                    });
                });
            }

            if(resultsSemesterFilter) { resultsSemesterFilter.addEventListener('change', function() { renderAcademicResults(this.value); }); }
            
            const financeSemesterFilter = document.getElementById('finance-semester-filter');
            const financeContentArea = document.getElementById('financial-statements-content-area');
            if(financeSemesterFilter && financeContentArea){
                financeSemesterFilter.addEventListener('change', function(){
                    financeContentArea.querySelectorAll('.semester-content').forEach(sc => sc.style.display = 'none');
                    const targetContent = financeContentArea.querySelector(`#${this.value}-finance`);
                    if(targetContent) targetContent.style.display = 'block';
                    else financeContentArea.querySelector('.no-results')?.remove() || financeContentArea.insertAdjacentHTML('beforeend', '<p class="no-results">Financial data not found for this semester.</p>');
                });
                if(financeSemesterFilter.options.length > 0) financeSemesterFilter.dispatchEvent(new Event('change'));
            }


            const requestChangeBtn = document.getElementById('request-change-btn'); 
            const cancelChangeBtn = document.getElementById('cancel-change-btn'); 
            const changeRequestForm = document.getElementById('change-request-form');
            if (requestChangeBtn && changeRequestForm && cancelChangeBtn) { 
                 requestChangeBtn.addEventListener('click', () => changeRequestForm.classList.add('active'));
                cancelChangeBtn.addEventListener('click', () => changeRequestForm.classList.remove('active'));
            }

            const notificationIcon = document.querySelector('.notification-icon'); 
            const notificationDropdown = document.querySelector('.notification-dropdown');
            if (notificationIcon && notificationDropdown) { 
                notificationIcon.addEventListener('click', (event) => { event.stopPropagation(); notificationDropdown.classList.toggle('show'); });
                document.addEventListener('click', (event) => { if (notificationDropdown.classList.contains('show') && !notificationIcon.contains(event.target) && !notificationDropdown.contains(event.target)) { notificationDropdown.classList.remove('show'); } });
            }
            
            function populateModal(courseCode) { 
                const courseInfo = studentRegisteredCourses.find(c => c.courseCode === courseCode && (c.semester === currentAcademicSemesterKey || c.semester === document.getElementById('registered-courses-semester-filter')?.value )) || 
                                 tempSelectedCourses.find(c => c.courseCode === courseCode) || 
                                 coursesData[courseCode];

                const data = courseInfo || { title: "Details not found", credit:"", section:"", desc:"", time:"", room:"", facultyName:"", assessments:[] };
                
                courseModalTitleText.textContent = `${courseCode} - ${data.title}`;
                courseModal.querySelector('.modal-course-code').value = courseCode;
                courseModal.querySelector('.modal-course-title-input').value = data.title;
                courseModal.querySelector('.modal-course-credit').value = data.credit || 'N/A';
                courseModal.querySelector('.modal-course-section').value = data.section || 'N/A'; 
                courseModal.querySelector('.modal-course-desc').value = data.desc || 'No description available.';
                courseModal.querySelector('.modal-course-time').value = data.time || 'N/A';
                courseModal.querySelector('.modal-course-room').value = data.room || 'N/A';
                courseModal.querySelector('.modal-faculty-name').textContent = data.facultyName || data.faculty || 'TBA';

                const assessmentTableBody = courseModal.querySelector('.modal-assessment-table-body');
                assessmentTableBody.innerHTML = ''; 
                const courseMasterData = coursesData[courseCode]; 
                if(courseMasterData && courseMasterData.assessments && courseMasterData.assessments.length > 0) {
                    courseMasterData.assessments.forEach(asm => { const row = assessmentTableBody.insertRow(); row.insertCell().textContent = asm.type; row.insertCell().textContent = asm.weight; row.insertCell().textContent = asm.score; row.insertCell().textContent = asm.max; });
                } else { assessmentTableBody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No assessment details available.</td></tr>'; }
                
                modalTabs.forEach(t => t.classList.remove('active'));
                courseModal.querySelector('.modal-tab[data-tab="overview"]').classList.add('active');
                courseModal.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                courseModal.querySelector('#overview-tab').classList.add('active');
            }
            function openCourseModal(courseCode) { 
                 if (!courseCode) { console.error("Course code is undefined for modal."); return; }
                populateModal(courseCode);
                courseModal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
            function closeCourseModal() { courseModal.style.display = 'none'; document.body.style.overflow = ''; }
            if (closeModalBtn) closeModalBtn.addEventListener('click', closeCourseModal);
            window.addEventListener('click', (e) => { if (e.target === courseModal) closeCourseModal(); });
            modalTabs.forEach(tab => { 
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    modalTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    courseModal.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    const targetTabContent = courseModal.querySelector(`#${tabId}-tab`) || courseModal.querySelector(`#${tabId}-breakdown-tab`) || courseModal.querySelector(`#results-breakdown-tab`); 
                    if (targetTabContent) targetTabContent.classList.add('active');
                });
            });
            
            function attachModalListenersToScheduleItems(container) { 
                 container.querySelectorAll('.schedule-item').forEach(item => {
                    item.addEventListener('click', function() {
                        openCourseModal(this.dataset.courseCode);
                    });
                });
            }
            
            const viewPaymentHistoryBtn = document.getElementById('view-payment-history'); 
            const paymentHistorySection = document.getElementById('payment-history');
            if (viewPaymentHistoryBtn && paymentHistorySection) { 
                 viewPaymentHistoryBtn.addEventListener('click', function() {
                    const isHidden = paymentHistorySection.style.display === 'none' || paymentHistorySection.style.display === '';
                    paymentHistorySection.style.display = isHidden ? 'block' : 'none';
                    if (isHidden) paymentHistorySection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                });
            }

            const examTabs = document.querySelectorAll('#exam-schedule .exam-tab'); 
            const examContents = document.querySelectorAll('#exam-schedule .exam-content');
            examTabs.forEach(tab => { 
                 tab.addEventListener('click', function() {
                    examTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const targetType = this.dataset.examType;
                    examContents.forEach(content => {
                        content.classList.remove('active'); 
                        if (content.id === `${targetType}-exams`) content.classList.add('active');
                    });
                });
            });

            function parseDayShorthand(dayStr) {
                const map = { 'S': 0, 'M': 1, 'T': 2, 'W': 3, 'Th': 4, 'F': 5, 'Sa': 6 };
                if (dayStr === "ST") return [0, 2]; 
                if (dayStr === "MW") return [1, 3]; 
                if (dayStr === "TTh") return [2, 4]; 
                let days = [];
                let currentDay = "";
                for (let char of dayStr) {
                    currentDay += char;
                    if (map[currentDay] !== undefined) {
                        days.push(map[currentDay]);
                        currentDay = "";
                    } else if (currentDay.length > 2) { 
                        console.warn("Could not parse day shorthand:", dayStr);
                        return null; 
                    }
                }
                return days.length > 0 ? days : null;
            }

            function parseTime(timeStr) { 
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes; 
            }

            function parseTimeSlot(timeString) { 
                if (!timeString || typeof timeString !== 'string') return null;
                const parts = timeString.split(' ');
                if (parts.length < 2) return null;

                const dayStr = parts[0];
                const timeRange = parts.slice(1).join(' '); 

                const days = parseDayShorthand(dayStr);
                if (!days) return null;

                const timeParts = timeRange.split('-');
                if (timeParts.length !== 2) return null;

                const startTime = parseTime(timeParts[0].trim());
                const endTime = parseTime(timeParts[1].trim());

                if (isNaN(startTime) || isNaN(endTime)) return null;

                return { days, startTime, endTime };
            }

            function checkTimeOverlap(slot1, slot2) {
                if (!slot1 || !slot2) return false;
                const daysOverlap = slot1.days.some(day1 => slot2.days.includes(day1));
                if (!daysOverlap) return false;
                const timesOverlap = slot1.startTime < slot2.endTime && slot2.startTime < slot1.endTime;
                return timesOverlap;
            }

            const registrationMainView = document.getElementById('registration-main-view');
            const offeredSectionsView = document.getElementById('offered-sections-view');
            const programCoursesListContainer = document.getElementById('program-courses-list');
            const offeredSectionsListContainer = document.getElementById('registration-course-list-container');
            const offeredSectionsTitle = document.getElementById('offered-sections-title');
            const backToAllCoursesBtn = document.getElementById('back-to-all-courses-btn');
            const programCourseSearchInput = document.getElementById('program-course-search-input');
            const sectionSearchInput = document.getElementById('section-search-input');
            
            const selectedCoursesListEl = document.getElementById('selected-courses-list');
            const finalConfirmButtonContainerEl = document.getElementById('final-confirm-button-container');


            function updateApplicationStatusCard() { 
                const statusCardContainer = document.getElementById('application-status-card-content'); 
                if (!statusCardContainer) return;
                
                statusCardContainer.querySelectorAll('.dynamic-status:not(.no-results)').forEach(el => el.remove());
                const noResultsEl = statusCardContainer.querySelector('.no-results.dynamic-status');

                let hasDynamicContent = false;

                const currentSemesterRegCourses = studentRegisteredCourses.filter(c => c.semester === currentAcademicSemesterKey);
                if (currentSemesterRegCourses.length > 0) { 
                    const regItem = document.createElement('div');
                    regItem.className = 'status-badge status-item dynamic-status'; 
                    regItem.innerHTML = `<span>${semesterNames[currentAcademicSemesterKey]} Registration</span> <span class="status-badge status-approved">Approved</span>`;
                    statusCardContainer.insertBefore(regItem, noResultsEl); 
                    hasDynamicContent = true;
                }

                courseDropRequests.filter(req => req.status === "Pending").forEach(req => {
                    const item = document.createElement('div');
                    item.className = 'status-badge status-item dynamic-status';
                    item.innerHTML = `<span>Drop Request: ${req.courseCode} (${req.section}) - ${semesterNames[req.semester] || req.semester}</span> <span class="status-badge status-pending">Pending</span>`;
                    statusCardContainer.appendChild(item);
                    hasDynamicContent = true;
                });
                
                if(noResultsEl) noResultsEl.style.display = hasDynamicContent ? 'none' : 'block';
            }


            function displayProgramCourses(filterTerm = "") { 
                if (!programCoursesListContainer) return;
                programCoursesListContainer.innerHTML = '';
                const filteredProgramCourses = programCoursesData.filter(course => 
                    course.code.toLowerCase().includes(filterTerm) ||
                    course.title.toLowerCase().includes(filterTerm)
                );
                if (filteredProgramCourses.length === 0) { programCoursesListContainer.innerHTML = '<p class="no-results">No program courses found.</p>'; return; }
                filteredProgramCourses.forEach(course => {
                    const availableSectionsCount = allOfferedSectionsData.filter(s => s.courseCode === course.code).length;
                    const item = document.createElement('div');
                    item.className = 'program-course-item';
                    item.dataset.courseCode = course.code;
                    item.innerHTML = `<h5><i class="fas fa-book-medical"></i> ${course.code} - ${course.title}</h5><p>${course.credits} Credits <span style="margin-left:10px; color:var(--accent); font-weight:500;">(${availableSectionsCount} Section${availableSectionsCount !== 1 ? 's' : ''} Available)</span></p>`;
                    item.addEventListener('click', function() { showOfferedSectionsForCourse(this.dataset.courseCode); });
                    programCoursesListContainer.appendChild(item);
                });
            }
            if (programCourseSearchInput) { programCourseSearchInput.addEventListener('input', function() { displayProgramCourses(this.value.toLowerCase().trim()); }); }


            function displayOfferedSections(sectionsToDisplay, forCourseCode) { 
                if (!offeredSectionsListContainer) return;
                const noResultsMsgEl = offeredSectionsListContainer.querySelector('.no-results');
                // Clear only course cards, not the no-results message itself
                Array.from(offeredSectionsListContainer.querySelectorAll('.registration-course-card')).forEach(card => card.remove());


                if (sectionsToDisplay.length === 0) { 
                    if(noResultsMsgEl) noResultsMsgEl.style.display = 'block'; 
                    return; 
                }
                if(noResultsMsgEl) noResultsMsgEl.style.display = 'none';

                sectionsToDisplay.forEach(sectionData => {
                    const card = document.createElement('div'); card.className = 'registration-course-card';
                    const isFull = sectionData.enrolled >= sectionData.capacity;
                    
                    // Check if already in tempSelectedCourses OR studentRegisteredCourses for this semester
                    const isSelectedInTemp = tempSelectedCourses.some(tc => tc.courseCode === sectionData.courseCode && tc.section === sectionData.section);
                    const isRegisteredThisSemester = studentRegisteredCourses.some(rc => rc.semester === currentAcademicSemesterKey && rc.courseCode === sectionData.courseCode && rc.section === sectionData.section);
                    const isRegisteredAnySectionThisCourse = studentRegisteredCourses.some(rc => rc.semester === currentAcademicSemesterKey && rc.courseCode === sectionData.courseCode);
                    const isSelectedAnySectionThisCourseInTemp = tempSelectedCourses.some(tc => tc.courseCode === sectionData.courseCode);


                    const newSlot = parseTimeSlot(sectionData.time); let hasConflict = false;
                    if (newSlot && !isSelectedInTemp && !isRegisteredThisSemester) { 
                        // Check conflict with already registered courses
                        for (const regCourse of studentRegisteredCourses.filter(rc => rc.semester === currentAcademicSemesterKey)) { 
                            const existingSlot = parseTimeSlot(regCourse.time); 
                            if (checkTimeOverlap(newSlot, existingSlot)) { hasConflict = true; card.classList.add('conflict'); break; } 
                        }
                        // Check conflict with temp selected courses (if no conflict with registered ones yet)
                        if(!hasConflict) {
                            for (const tempCourse of tempSelectedCourses) {
                                const tempSlot = parseTimeSlot(tempCourse.time);
                                if (checkTimeOverlap(newSlot, tempSlot)) { hasConflict = true; card.classList.add('conflict'); break; }
                            }
                        }
                    }

                    let buttonHTML;
                    if (isSelectedInTemp) {
                         buttonHTML = `<button class="btn btn-sm btn-warning remove-temp-course-btn" data-course-code="${sectionData.courseCode}" data-section="${sectionData.section}"><i class="fas fa-minus-circle"></i> Selected (Click to Unselect)</button>`;
                    } else if (isRegisteredThisSemester) { // If already officially registered
                        buttonHTML = `<button class="btn btn-sm btn-outline-success disabled" disabled><i class="fas fa-check-circle"></i> Already Registered</button>`;
                    } else if (isRegisteredAnySectionThisCourse || isSelectedAnySectionThisCourseInTemp) {
                         buttonHTML = `<button class="btn btn-sm btn-secondary disabled" disabled title="Already selected/registered for ${sectionData.courseCode} in another section."><i class="fas fa-ban"></i> Course Added (Other Section)</button>`;
                    } else if (isFull) {
                        buttonHTML = `<button class="btn btn-sm btn-danger disabled" disabled><i class="fas fa-times-circle"></i> Full</button>`;
                    } else if (hasConflict) {
                        buttonHTML = `<button class="btn btn-sm btn-danger disabled" disabled title="Time conflict with another selected/registered course."><i class="fas fa-exclamation-triangle"></i> Time Conflict</button>`;
                    } else {
                        buttonHTML = `<button class="btn btn-sm btn-success add-course-btn" data-course-code="${sectionData.courseCode}" data-section="${sectionData.section}"><i class="fas fa-plus-circle"></i> Add to Selection</button>`;
                    }
                    card.innerHTML = `<h4>${sectionData.courseCode} - Section ${sectionData.section}</h4> <p><i class="fas fa-clock"></i> ${sectionData.time}</p> <p><i class="fas fa-map-marker-alt"></i> Room: ${sectionData.room}</p> <p><i class="fas fa-chalkboard-teacher"></i> Faculty: ${sectionData.faculty}</p> <p><i class="fas fa-users"></i> Enrollment: <span class="enrollment-status">${sectionData.enrolled}/${sectionData.capacity}</span></p> ${buttonHTML}`;
                    offeredSectionsListContainer.appendChild(card);
                });
                offeredSectionsListContainer.querySelectorAll('.add-course-btn').forEach(button => button.addEventListener('click', handleAddToTempSelectionClick));
                offeredSectionsListContainer.querySelectorAll('.remove-temp-course-btn').forEach(button => button.addEventListener('click', function() {
                     handleRemoveFromTempSelection(this.dataset.courseCode, this.dataset.section, true); // true to re-render offered sections
                }));
            }
            
            function handleAddToTempSelectionClick(event) { 
                const button = event.target.closest('.add-course-btn');
                const courseCode = button.dataset.courseCode;
                const section = button.dataset.section;

                // Check if already selected in temp or registered in studentRegisteredCourses for THIS course
                if (tempSelectedCourses.some(tc => tc.courseCode === courseCode) || studentRegisteredCourses.some(rc => rc.semester === currentAcademicSemesterKey && rc.courseCode === courseCode)) {
                    showToast(`You have already selected or registered for ${courseCode}. You cannot add multiple sections of the same course.`, 'error');
                    return;
                }

                const sectionData = allOfferedSectionsData.find(s => s.courseCode === courseCode && s.section === section);
                const courseMasterData = coursesData[courseCode] || programCoursesData.find(pc => pc.code === courseCode);
                
                const newSlot = parseTimeSlot(sectionData.time);
                if (newSlot) { 
                     for (const regCourse of studentRegisteredCourses.filter(rc => rc.semester === currentAcademicSemesterKey)) { 
                        const existingSlot = parseTimeSlot(regCourse.time); 
                        if (checkTimeOverlap(newSlot, existingSlot)) { 
                            showToast(`Time conflict with your registered course ${regCourse.courseCode} (${regCourse.time}). Cannot select.`, 'error'); 
                            return; 
                        } 
                    }
                    for (const tempCourse of tempSelectedCourses) {
                        const tempSlot = parseTimeSlot(tempCourse.time);
                        if (checkTimeOverlap(newSlot, tempSlot)) {
                            showToast(`Time conflict with your selected course ${tempCourse.courseCode} (${tempCourse.time}). Cannot select.`, 'error');
                            return;
                        }
                    }
                }

                if (sectionData && courseMasterData) { 
                    tempSelectedCourses.push({ 
                        semester: currentAcademicSemesterKey, // Will be finalized on confirm
                        courseCode: sectionData.courseCode, 
                        title: courseMasterData.title, 
                        credit: courseMasterData.credits || courseMasterData.credit, 
                        section: sectionData.section, 
                        time: sectionData.time, 
                        room: sectionData.room, 
                        faculty: sectionData.faculty,
                        grade: "IP", 
                        gradePoint: null
                    }); 
                    sectionData.enrolled++; 
                    
                    renderSelectedCoursesForRegistration();
                    // Re-render offered sections for THIS course to update button states
                    const currentCourseCodeForSectionsViewMatch = offeredSectionsTitle.textContent.match(/for (\w+)\s*-/);
                    const currentCourseCodeForSectionsView = currentCourseCodeForSectionsViewMatch ? currentCourseCodeForSectionsViewMatch[1] : null;
                    if (currentCourseCodeForSectionsView && currentCourseCodeForSectionsView === courseCode) {
                        showOfferedSectionsForCourse(courseCode); 
                    }
                    showToast(`${courseCode} - Section ${section} added to your selection.`, 'info'); 
                } else { showToast(`Error selecting course. Data not found.`, 'error'); }
            }

            function handleRemoveFromTempSelection(courseCode, section, rerenderOffered = false) {
                const courseIndex = tempSelectedCourses.findIndex(tc => 
                    tc.courseCode === courseCode && tc.section === section
                );

                if (courseIndex > -1) {
                    tempSelectedCourses.splice(courseIndex, 1);
                    const sectionData = allOfferedSectionsData.find(s => s.courseCode === courseCode && s.section === section);
                    if (sectionData) {
                        sectionData.enrolled = Math.max(0, sectionData.enrolled - 1);
                    }
                    
                    renderSelectedCoursesForRegistration();
                    if (rerenderOffered) {
                        const currentCourseCodeForSectionsViewMatch = offeredSectionsTitle.textContent.match(/for (\w+)\s*-/);
                        const currentCourseCodeForSectionsView = currentCourseCodeForSectionsViewMatch ? currentCourseCodeForSectionsViewMatch[1] : null;
                         if (offeredSectionsView.style.display === 'block' && currentCourseCodeForSectionsView && currentCourseCodeForSectionsView === courseCode) {
                            showOfferedSectionsForCourse(courseCode);
                        }
                    }
                    showToast(`${courseCode} - Section ${section} removed from your selection.`, 'info');
                }
            }


            function showOfferedSectionsForCourse(courseCode) { 
                const course = programCoursesData.find(c => c.code === courseCode) || coursesData[courseCode];
                if (offeredSectionsTitle && course) offeredSectionsTitle.textContent = `Offered Sections for ${courseCode} - ${course.title}`;
                const filteredSections = allOfferedSectionsData.filter(s => s.courseCode === courseCode);
                displayOfferedSections(filteredSections, courseCode); 
                if (registrationMainView) registrationMainView.style.display = 'none';
                if (offeredSectionsView) offeredSectionsView.style.display = 'block';
                if (sectionSearchInput) sectionSearchInput.value = ''; 
            }

             if (sectionSearchInput) { 
                sectionSearchInput.addEventListener('input', function() {
                    const filterTerm = this.value.toLowerCase().trim();
                    const currentCourseCodeMatch = offeredSectionsTitle.textContent.match(/for (\w+)\s*-/); 
                    const currentCourseCode = currentCourseCodeMatch ? currentCourseCodeMatch[1] : null;
                    
                    let sectionsToFilter = allOfferedSectionsData;
                    if(currentCourseCode && offeredSectionsView.style.display === 'block') { 
                        sectionsToFilter = allOfferedSectionsData.filter(s => s.courseCode === currentCourseCode);
                    }

                    const filteredSections = sectionsToFilter.filter(s =>
                        s.faculty.toLowerCase().includes(filterTerm) ||
                        s.time.toLowerCase().includes(filterTerm) ||
                        s.room.toLowerCase().includes(filterTerm)
                    );
                    displayOfferedSections(filteredSections, currentCourseCode);
                });
             }
            

            if (backToAllCoursesBtn) { 
                 backToAllCoursesBtn.addEventListener('click', function() {
                    if (registrationMainView) registrationMainView.style.display = 'block';
                    if (offeredSectionsView) offeredSectionsView.style.display = 'none';
                    if (programCourseSearchInput) programCourseSearchInput.value = ''; 
                    displayProgramCourses(); 
                });
            }
            
            function renderSelectedCoursesForRegistration() {
                if (!selectedCoursesListEl || !finalConfirmButtonContainerEl) return;
                selectedCoursesListEl.innerHTML = ''; // Clear previous
                finalConfirmButtonContainerEl.innerHTML = ''; // Clear button

                if (tempSelectedCourses.length === 0) {
                    selectedCoursesListEl.innerHTML = '<p class="no-results">No courses selected yet. Add courses from the list below.</p>';
                    return;
                }

                tempSelectedCourses.forEach(course => {
                    const card = document.createElement('div');
                    card.className = 'registration-course-card'; // Can add a modifier class if needed
                    card.innerHTML = `
                        <h4>${course.courseCode} - ${course.title} (Section ${course.section})</h4>
                        <p><i class="fas fa-clock"></i> ${course.time}</p>
                        <p><i class="fas fa-map-marker-alt"></i> Room: ${course.room}</p>
                        <p><i class="fas fa-chalkboard-teacher"></i> Faculty: ${course.faculty}</p>
                        <p><i class="fas fa-coins"></i> Credits: ${course.credit.toFixed(1)}</p>
                        <button class="btn btn-sm btn-danger remove-temp-course-btn" data-course-code="${course.courseCode}" data-section="${course.section}" style="align-self: flex-end;"><i class="fas fa-times-circle"></i> Remove from Selection</button>
                    `;
                    selectedCoursesListEl.appendChild(card);
                });

                selectedCoursesListEl.querySelectorAll('.remove-temp-course-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        handleRemoveFromTempSelection(this.dataset.courseCode, this.dataset.section, true); // true to rerender offered section if visible
                    });
                });

                // Add the confirm button
                 const confirmBtn = document.createElement('button');
                 confirmBtn.id = 'final-confirm-registration-btn';
                 confirmBtn.className = 'btn btn-success';
                 confirmBtn.innerHTML = '<i class="fas fa-check-circle"></i> Confirm Registration & Update Portal';
                 confirmBtn.addEventListener('click', finalizeRegistration);
                 finalConfirmButtonContainerEl.appendChild(confirmBtn);
            }

            function finalizeRegistration() {
                if (tempSelectedCourses.length === 0) {
                    showToast("No courses selected to confirm.", "warning");
                    return;
                }
                if (confirm(`Are you sure you want to confirm these ${tempSelectedCourses.length} selected course(s)? This will update your official registration.`)) {
                    // Merge tempSelectedCourses into studentRegisteredCourses
                    // Ensure no duplicates by courseCode (assuming one section per course rule)
                    tempSelectedCourses.forEach(tempCourse => {
                        if (!studentRegisteredCourses.some(rc => rc.semester === currentAcademicSemesterKey && rc.courseCode === tempCourse.courseCode)) {
                            studentRegisteredCourses.push({...tempCourse}); // Add a copy
                        }
                    });
                    
                    tempSelectedCourses = []; // Clear temp selections
                    renderSelectedCoursesForRegistration(); // Update the selected courses display (will show empty)
                    
                    // Refresh all relevant portal sections
                    updateApplicationStatusCard();
                    if (document.getElementById('registered-courses').style.display === 'block' || document.querySelector('.sidebar-menu a[href="#registered-courses"].active')) {
                       renderRegisteredCoursesTable(currentAcademicSemesterKey);
                    }
                    if (document.getElementById('class-schedule-page').style.display === 'block' || document.querySelector('.sidebar-menu a[href="#class-schedule-page"].active')) {
                        loadClassSchedule(currentAcademicSemesterKey);
                    }
                    if (document.getElementById('academic-results').style.display === 'block' || document.querySelector('.sidebar-menu a[href="#academic-results"].active')) {
                        renderAcademicResults(currentAcademicSemesterKey);
                    }
                    loadDashboardData(); // Always update dashboard
                    
                    showToast("Registration Finalized and Portal Updated!", 'success');
                    // Optionally, navigate away or reset offered sections view
                    if (offeredSectionsView.style.display === 'block') {
                         showOfferedSectionsForCourse(offeredSectionsTitle.textContent.match(/for (\w+)\s*-/)?.[1]); // Re-render offered sections
                    }
                }
            }


            const dropCourseListEl = document.getElementById('drop-course-list');
            const dropHistoryTableContainerEl = document.getElementById('drop-history-table-container');
            const dropAppCurrentSemesterNameEl = document.getElementById('drop-app-current-semester-name');

            function renderDropApplicationPage() { 
                if(dropAppCurrentSemesterNameEl) dropAppCurrentSemesterNameEl.textContent = semesterNames[currentAcademicSemesterKey] || currentAcademicSemesterKey;
                if (dropCourseListEl) {
                    const coursesToDrop = studentRegisteredCourses.filter(c => c.semester === currentAcademicSemesterKey);
                    if (coursesToDrop.length === 0) { dropCourseListEl.innerHTML = '<p class="no-results">No courses registered in the current semester to drop.</p>'; } else {
                        let listHTML = '<table><thead><tr><th>Course Code</th><th>Title</th><th>Section</th><th>Action</th></tr></thead><tbody>';
                        coursesToDrop.forEach(course => { const isPending = courseDropRequests.some(req => req.courseCode === course.courseCode && req.section === course.section && req.status === "Pending" && req.semester === currentAcademicSemesterKey); listHTML += `<tr><td>${course.courseCode}</td><td>${course.title}</td><td>${course.section}</td><td>${isPending ? '<span class="status-badge status-pending">Drop Requested</span>' : `<button class="btn btn-sm btn-danger request-drop-btn" data-course-code="${course.courseCode}" data-course-title="${course.title}" data-section="${course.section}">Request Drop</button>`}</td></tr>`; });
                        listHTML += '</tbody></table>'; dropCourseListEl.innerHTML = listHTML;
                        dropCourseListEl.querySelectorAll('.request-drop-btn').forEach(button => button.addEventListener('click', function() { if (confirm(`Are you sure you want to request dropping ${this.dataset.courseCode} - ${this.dataset.courseTitle} (Section ${this.dataset.section})?`)) handleCourseDropRequest(this.dataset.courseCode, this.dataset.courseTitle, this.dataset.section); }));
                    }
                }
                renderDropHistoryTable();
            }

            function handleCourseDropRequest(courseCode, courseTitle, section) { 
                const existingPendingRequest = courseDropRequests.some(req => 
                    req.courseCode === courseCode && req.section === section && req.status === "Pending" && req.semester === currentAcademicSemesterKey
                );
                if (existingPendingRequest) { showToast(`A drop request for ${courseCode} - Section ${section} is already pending.`, 'warning'); return; }

                courseDropRequests.push({ semester: currentAcademicSemesterKey, courseCode, courseTitle, section, requestDate: new Date().toISOString().slice(0,10), status: "Pending" });
                showToast(`Drop request for ${courseCode} - Section ${section} submitted.`, 'info');
                renderDropApplicationPage(); 
                updateApplicationStatusCard(); 
            }

             function renderDropHistoryTable() {
                if (!dropHistoryTableContainerEl) return;
                if (courseDropRequests.length === 0) {
                    dropHistoryTableContainerEl.innerHTML = '<p class="no-results">No drop request history found.</p>';
                    return;
                }
                let historyHTML = '<table><thead><tr><th>Request Date</th><th>Semester</th><th>Course Code</th><th>Title</th><th>Section</th><th>Status</th></tr></thead><tbody>';
                courseDropRequests.forEach(req => {
                    let statusClass = '';
                    if (req.status === "Pending") statusClass = 'status-pending';
                    else if (req.status === "Approved") statusClass = 'status-approved';
                    else if (req.status === "Rejected") statusClass = 'status-rejected';
                    historyHTML += `<tr>
                                        <td>${req.requestDate}</td>
                                        <td>${semesterNames[req.semester] || req.semester}</td>
                                        <td>${req.courseCode}</td>
                                        <td>${req.courseTitle}</td>
                                        <td>${req.section}</td>
                                        <td><span class="status-badge ${statusClass}">${req.status}</span></td>
                                    </tr>`;
                });
                historyHTML += '</tbody></table>';
                dropHistoryTableContainerEl.innerHTML = historyHTML;
            }


            const monthYearDisplay = document.getElementById('month-year-display');
            const calendarGrid = document.querySelector('#academic-calendar-page .calendar-grid');
            const prevMonthBtn = document.getElementById('prev-month-btn');
            const nextMonthBtn = document.getElementById('next-month-btn');
            const eventPopup = document.getElementById('calendar-event-details-popup');
            const eventPopupTitle = document.getElementById('calendar-event-popup-title');
            const eventPopupBody = document.getElementById('calendar-event-popup-body');
            const closeEventPopupBtn = document.getElementById('close-calendar-event-popup');
            let currentCalendarDate = new Date(); 
            
             const academicCalendarEventsData = {
                "2024-01-01": [{ title: "New Year's Day", type: "holiday", icon: "fas fa-calendar-day", description: "University Holiday." }],
                "2024-01-15": [{ title: "Spring Semester Classes Start", type: "registration", icon: "fas fa-play-circle", description: "First day of classes for Spring 2024." }],
                "2024-01-22": [{ title: "Last Day to Add/Drop Courses (Spring)", type: "deadline", icon: "fas fa-calendar-times", description: "Final day for course registration changes without penalty." }],
                "2024-02-14": [{ title: "Falgun & Valentine's Day", type: "other", icon: "fas fa-heart", description: "Campus cultural events (regular classes)." }],
                "2024-02-21": [{ title: "International Mother Language Day", type: "holiday", icon: "fas fa-monument", description: "University closed." }],
                "2024-03-08": [{ title: "Quiz 1 Period Starts", type: "exam", icon: "fas fa-file-alt", description: "First quiz period for Spring 2024 courses." }],
                "2024-03-17": [{ title: "Birthday of Bangabandhu Sheikh Mujibur Rahman", type: "holiday", icon: "fas fa-flag", description: "National Holiday." }],
                "2024-03-25": [{ title: "Midterm Exams Start", type: "exam", icon: "fas fa-file-signature", description: "Midterm examinations for Spring 2024 begin today." }],
                "2024-03-26": [{ title: "Independence Day", type: "holiday", icon: "fas fa-flag-checkered", description: "National Holiday." }],
                "2024-04-01": [{ title: "Quiz 2 Period Starts", type: "exam", icon: "fas fa-file-alt", description: "Second quiz period for Spring 2024 courses." }],
                "2024-04-05": [{ title: "Midterm Exams End", type: "exam", icon: "fas fa-file-signature", description: "Midterm examinations for Spring 2024 conclude." }],
                "2024-04-10": [{ title: "Project Submission (CSE3205)", type: "deadline", icon: "fas fa-clipboard-check", description: "Deadline for CSE3205 project." }, { title: "Eid-ul-Fitr Holiday Starts (Tentative)", type: "holiday", icon: "fas fa-moon", description: "University closed for Eid celebrations." }],
                "2024-04-14": [{ title: "Pohela Boishakh", type: "holiday", icon: "fas fa-glass-cheers", description: "University closed for Pohela Boishakh." }],
                "2024-04-20": [{ title: "Classes Resume after Eid", type: "other", icon: "fas fa-undo", description: "Classes resume after Eid & Pohela Boishakh holidays." }],
                "2024-05-01": [{ title: "May Day", type: "holiday", icon: "fas fa-hard-hat", description: "University closed for May Day." }],
                "2024-05-10": [{ title: "Last Day of Classes (Spring)", type: "other", icon: "fas fa-stop-circle", description: "Final day of lectures for Spring 2024." }],
                "2024-05-12": [{ title: "Study Break Starts", type: "other", icon: "fas fa-book-reader", description: "Study break before final exams." }],
                "2024-05-15": [{ title: "Final Exam Schedule Publish", type: "other", icon: "fas fa-calendar-alt", description: "Tentative date for final exam schedule publication."}],
                "2024-05-20": [{ title: "Final Exams Start (Spring)", type: "exam", icon: "fas fa-graduation-cap", description: "Final examinations for Spring 2024 begin." }],
                "2024-06-02": [{ title: "Final Exams End (Spring)", type: "exam", icon: "fas fa-graduation-cap", description: "Final examinations for Spring 2024 conclude." }],
                "2024-06-10": [{ title: "Grade Submission Deadline (Faculty)", type: "deadline", icon: "fas fa-user-check", description: "Faculty deadline to submit final grades." }],
                "2024-06-15": [{ title: "Results Publication (Spring)", type: "other", icon: "fas fa-chart-bar", description: "Tentative date for Spring 2024 results." }],
                "2024-06-17": [{ title: "Eid-ul-Adha Holiday (Tentative)", type: "holiday", icon: "fas fa-mosque", description: "University closed for Eid-ul-Adha." }],
                "2024-06-20": [{ title: "Summer Semester Registration Starts", type: "registration", icon: "fas fa-edit", description: "Registration period for Summer 2024 opens." }],
                "2024-07-01": [{ title: "Summer Semester Classes Start", type: "registration", icon: "fas fa-play-circle", description: "First day of classes for Summer 2024." }],
                "2024-07-10": [{ title: "Last Day to Add/Drop Courses (Summer)", type: "deadline", icon: "fas fa-calendar-times", description: "Final day for Summer 2024 course changes." }],
                "2024-08-15": [{ title: "National Mourning Day", type: "holiday", icon: "fas fa-flag", description: "University closed." }],
                "2024-08-20": [{ title: "Summer Midterm Exams Start", type: "exam", icon: "fas fa-file-signature", description: "Midterm exams for Summer 2024." }],
                "2024-09-05": [{ title: "Summer Midterm Exams End", type: "exam", icon: "fas fa-file-signature", description: "Summer midterm exams conclude." }],
                "2024-09-16": [{ title: "Eid-e-Miladunnabi (Tentative)", type: "holiday", icon: "fas fa-moon", description: "University holiday." }],
                "2024-09-25": [{ title: "Last Day of Classes (Summer)", type: "other", icon: "fas fa-stop-circle", description: "Final day of lectures for Summer 2024." }],
                "2024-10-01": [{ title: "Summer Final Exams Start", type: "exam", icon: "fas fa-graduation-cap", description: "Final exams for Summer 2024 begin." }],
                "2024-10-13": [{ title: "Durga Puja (Bijoya Dashami)", type: "holiday", icon: "fas fa-om", description: "University closed for Durga Puja." }],
                "2024-10-15": [{ title: "Summer Final Exams End", type: "exam", icon: "fas fa-graduation-cap", description: "Summer final exams conclude." }],
                "2024-10-25": [{ title: "Results Publication (Summer)", type: "other", icon: "fas fa-chart-bar", description: "Tentative date for Summer 2024 results." }],
                "2024-10-28": [{ title: "Fall Semester Registration Starts", type: "registration", icon: "fas fa-edit", description: "Registration for Fall 2024 opens." }],
                "2024-11-10": [{ title: "Fall Semester Classes Start", type: "registration", icon: "fas fa-play-circle", description: "First day of classes for Fall 2024." }],
                "2024-12-16": [{ title: "Victory Day", type: "holiday", icon: "fas fa-flag-checkered", description: "National Holiday." }],
                "2024-12-25": [{ title: "Christmas Day", type: "holiday", icon: "fas fa-church", description: "University Holiday." }]
            };


            function generateCalendar(year, month) {
                if (!calendarGrid) return;
                const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                if(monthYearDisplay) monthYearDisplay.textContent = `${monthNames[month]} ${year}`;
                
                const dayCells = calendarGrid.querySelectorAll('.calendar-day-cell, .empty-day');
                dayCells.forEach(cell => cell.remove());

                const firstDayOfMonth = new Date(year, month, 1).getDay(); 
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let i = 0; i < firstDayOfMonth; i++) {
                    calendarGrid.insertAdjacentHTML('beforeend', '<div class="calendar-day-cell empty-day"></div>');
                }

                const today = new Date();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                    
                    let dayCellHTML = `<div class="calendar-day-cell ${isToday ? 'today' : ''}">
                                        <div class="day-number">${day}</div>`;
                    
                    if (academicCalendarEventsData[dateStr]) {
                        academicCalendarEventsData[dateStr].forEach(event => {
                            dayCellHTML += `<div class="calendar-event ${event.type}" data-event-title="${event.title}" data-event-desc="${event.description || ''}" data-event-date="${dateStr}">
                                                ${event.icon ? `<i class="${event.icon}"></i>` : ''}
                                                ${event.title}
                                                <span class="event-tooltip">${event.title} - ${event.description || 'No further details.'}</span>
                                            </div>`;
                        });
                    }
                    dayCellHTML += `</div>`;
                    calendarGrid.insertAdjacentHTML('beforeend', dayCellHTML);
                }
                
                calendarGrid.querySelectorAll('.calendar-event').forEach(eventEl => {
                    eventEl.addEventListener('click', function() {
                        if(eventPopupTitle) eventPopupTitle.textContent = this.dataset.eventTitle;
                        if(eventPopupBody) eventPopupBody.innerHTML = `<p><strong>Date:</strong> ${new Date(this.dataset.eventDate + "T00:00:00").toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                                                  <p>${this.dataset.eventDesc || 'No further details.'}</p>`;
                        if(eventPopup) eventPopup.style.display = 'block';
                    });
                });
            }

            if (prevMonthBtn) prevMonthBtn.addEventListener('click', () => { currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1); generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth()); });
            if (nextMonthBtn) nextMonthBtn.addEventListener('click', () => { currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1); generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth()); });
            if(closeEventPopupBtn && eventPopup) { closeEventPopupBtn.addEventListener('click', () => eventPopup.style.display = 'none'); window.addEventListener('click', (e) => { if(e.target === eventPopup) eventPopup.style.display = 'none'; }); }
            


            const pageNavButton = document.querySelector('.page-navigation');
            const sidebar = document.querySelector('.sidebar');
            if (pageNavButton && sidebar) {
                pageNavButton.addEventListener('click', function() {
                    if (window.innerWidth <= 992) { 
                        const isSidebarHidden = sidebar.style.display === 'none' || sidebar.style.display === '';
                        sidebar.style.display = isSidebarHidden ? 'block' : 'none';
                        this.querySelector('i').classList.toggle('fa-bars', !isSidebarHidden);
                        this.querySelector('i').classList.toggle('fa-times', isSidebarHidden);
                    }
                });
                function handleResizeForFAB() {
                    if (window.innerWidth > 992) {
                        pageNavButton.style.display = 'none';
                        sidebar.style.display = 'block'; 
                    } else {
                        pageNavButton.style.display = 'flex';
                         if (!sidebar.classList.contains('keep-open-mobile')) { 
                           sidebar.style.display = 'none'; 
                        }
                         pageNavButton.querySelector('i').classList.add('fa-bars');
                         pageNavButton.querySelector('i').classList.remove('fa-times');
                    }
                }
                window.addEventListener('resize', handleResizeForFAB);
                handleResizeForFAB(); 
            }

            // --- Initial Load ---
            let initialHash = window.location.hash;
            if (!initialHash || initialHash === '#') initialHash = '#dashboard';
            showPage(initialHash);
            setActiveLink(initialHash);
            
            if (document.getElementById('registration-schedule')) { 
                renderSelectedCoursesForRegistration(); // Ensure this is called
                displayProgramCourses(); 
            }
            updateApplicationStatusCard(); 

        });
    </script>
</body>
</html>
